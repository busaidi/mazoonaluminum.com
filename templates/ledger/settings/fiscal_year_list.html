{% extends "ledger/base_ledger.html" %}
{% load i18n %}

{% block ledger_content %}
<div class="d-flex justify-content-between align-items-center mb-2">
  <div>
    <h2 class="h5 mb-1">{% trans "السنوات المالية" %}</h2>
    <p class="text-muted small mb-0">
      {% trans "من هنا يمكنك إدارة فترات عمل النظام (البداية والنهاية) وإقفال السنوات المالية بعد الانتهاء منها." %}
    </p>
  </div>
  <a href="{% url 'ledger:fiscal_year_create' %}" class="btn btn-sm btn-primary">
    <span class="ms-1">+</span> {% trans "إنشاء سنة مالية جديدة" %}
  </a>
</div>

<div class="card shadow-sm">
  <div class="card-body p-0">

    <div class="table-responsive">
      <table class="table table-hover mb-0 align-middle">
        <thead class="table-light">
          <tr>
            <th style="width: 10%;">{% trans "السنة" %}</th>
            <th style="width: 35%;">{% trans "الفترة" %}</th>
            <th style="width: 20%;">{% trans "الحالة" %}</th>
            <th class="text-end" style="width: 35%;">{% trans "الإجراءات" %}</th>
          </tr>
        </thead>
        <tbody>
          {% for y in years %}
          <tr>
            <td class="fw-semibold">
              {{ y.year }}
            </td>
            <td>
              <div class="small">
                {{ y.start_date }} — {{ y.end_date }}
              </div>
            </td>
            <td>
              {% if y.is_closed %}
                <span class="badge rounded-pill bg-outline-danger text-danger border border-danger-subtle px-3 py-1">
                  {% trans "مقفلة" %}
                </span>
              {% else %}
                <span class="badge rounded-pill bg-outline-success text-success border border-success-subtle px-3 py-1">
                  {% trans "مفتوحة" %}
                </span>
              {% endif %}
            </td>
            <td class="text-end">
              <div class="btn-group btn-group-sm" role="group">
                <a href="{% url 'ledger:fiscal_year_edit' y.pk %}"
                   class="btn btn-outline-secondary">
                  {% trans "تعديل" %}
                </a>

                {% if not y.is_closed %}
                <form method="post"
                      action="{% url 'ledger:fiscal_year_close' y.pk %}"
                      onsubmit="return confirm('{% trans "هل أنت متأكد من إقفال هذه السنة المالية؟" %}');">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-outline-danger">
                    {% trans "إقفال" %}
                  </button>
                </form>
                {% endif %}
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="4" class="text-center py-4 text-muted">
              {% trans "لا توجد سنوات مالية مُسجّلة حتى الآن." %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
</div>
{% endblock %}
