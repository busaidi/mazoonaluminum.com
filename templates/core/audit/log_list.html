{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "سجل التدقيق" %}{% endblock %}

{% block content %}
<div class="container my-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4 mb-0">{% trans "سجل التدقيق" %}</h1>

    <form method="get" class="d-flex gap-2 align-items-center">
      <input type="text"
             name="q"
             value="{{ request.GET.q }}"
             class="form-control form-control-sm"
             placeholder="{% trans 'بحث في الوصف' %}">
      <select name="action"
              class="form-select form-select-sm">
        <option value="">{% trans "كل العمليات" %}</option>
        {% for key, label in logs.model.Action.choices %}
          <option value="{{ key }}" {% if request.GET.action == key %}selected{% endif %}>
            {{ label }}
          </option>
        {% endfor %}
      </select>
      <button type="submit" class="btn btn-sm btn-outline-secondary">
        {% trans "تصفية" %}
      </button>
    </form>
  </div>

  {% if logs %}
    <div class="table-responsive">
      <table class="table table-sm table-striped align-middle">
        <thead class="table-light">
          <tr>
            <th style="width: 15%">{% trans "التاريخ" %}</th>
            <th style="width: 10%">{% trans "العملية" %}</th>
            <th style="width: 15%">{% trans "المستخدم" %}</th>
            <th style="width: 20%">{% trans "الهدف" %}</th>
            <th style="width: 40%">{% trans "الوصف" %}</th>
          </tr>
        </thead>
        <tbody>
          {% for log in logs %}
            <tr>
              <td class="text-nowrap">
                {{ log.created_at|date:"Y-m-d H:i" }}
              </td>
              <td>
                {{ log.get_action_display }}
              </td>
              <td>
                {% if log.actor %}
                  {{ log.actor.get_full_name|default:log.actor.username }}
                {% else %}
                  <span class="text-muted">{% trans "نظام" %}</span>
                {% endif %}
              </td>
              <td>
                {% if log.target %}
                  {{ log.target }}
                {% else %}
                  <span class="text-muted">—</span>
                {% endif %}
              </td>
              <td class="small">
                {{ log.message|default:"" }}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% if is_paginated %}
      <nav class="mt-3">
        <ul class="pagination pagination-sm">
          {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.previous_page_number }}">&laquo;</a>
            </li>
          {% endif %}
          {% for num in paginator.page_range %}
            <li class="page-item {% if page_obj.number == num %}active{% endif %}">
              <a class="page-link" href="?page={{ num }}">{{ num }}</a>
            </li>
          {% endfor %}
          {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.next_page_number }}">&raquo;</a>
            </li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}

  {% else %}
    <div class="alert alert-info">
      {% trans "لا توجد سجلات تدقيق حالياً." %}
    </div>
  {% endif %}
</div>
{% endblock %}

