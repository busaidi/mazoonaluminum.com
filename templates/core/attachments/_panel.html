{% load i18n %}

<div class="card border-0 shadow-sm mt-3">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div class="d-flex align-items-center gap-2">
        <h5 class="card-title mb-0">
          {% trans "Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª" %}
        </h5>
        <span class="badge bg-secondary">
          {{ attachments|length }} {% trans "Ù…Ø±ÙÙ‚(Ø§Øª)" %}
        </span>
      </div>
    </div>

    {# Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª #}
    <div class="table-responsive mb-3">
      <table class="table table-sm align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>{% trans "Ø§Ù„Ù…Ù„Ù" %}</th>
            <th>{% trans "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" %}</th>
            <th>{% trans "Ø§Ù„ÙˆØµÙ" %}</th>
            <th>{% trans "ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨ÙˆØ§Ø³Ø·Ø©" %}</th>
            <th>{% trans "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±ÙØ¹" %}</th>
            <th class="text-end"></th>
          </tr>
        </thead>
        <tbody>
        {% for att in attachments %}
          <tr>
            <td>
              {% with name=att.file.name %}
                {% with lower=name|lower %}
                  {% if lower|slice:"-4:" == ".pdf" %}
                    ğŸ“„
                  {% elif lower|slice:"-4:" == ".png" or lower|slice:"-4:" == ".jpg" or lower|slice:"-5:" == ".jpeg" %}
                    ğŸ–¼ï¸
                  {% else %}
                    ğŸ“
                  {% endif %}
                {% endwith %}
                <a href="{{ att.file.url }}"
                   target="_blank"
                   class="small text-decoration-none"
                   title="{{ name }}">
                  {{ name|slice:"-40:" }}
                </a>
              {% endwith %}
            </td>
            <td class="small">
              {{ att.title|default:"â€”" }}
            </td>
            <td class="small">
              {{ att.description|default:"â€”" }}
            </td>
            <td class="small">
              {% if att.uploaded_by %}
                {{ att.uploaded_by.get_full_name|default:att.uploaded_by.username }}
              {% else %}
                <span class="text-muted">â€”</span>
              {% endif %}
            </td>
            <td class="small text-nowrap">
              {{ att.uploaded_at|date:"Y-m-d H:i" }}
            </td>
            <td class="text-end">
              <form method="post"
                    action="{% url 'core:attachment_delete' att.pk %}"
                    onsubmit="return confirm('{% trans "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙÙ‚ØŸ" %}');"
                    class="d-inline">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ attachment_next_url }}">
                <button type="submit" class="btn btn-sm btn-outline-danger">
                  {% trans "Ø­Ø°Ù" %}
                </button>
              </form>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted small py-3">
              {% trans "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±ÙÙ‚Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†." %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>

    {# Ù†Ù…ÙˆØ°Ø¬ Ø±ÙØ¹ Ù…Ø±ÙÙ‚ Ø¬Ø¯ÙŠØ¯ #}
    <h6 class="mb-2">{% trans "Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙÙ‚ Ø¬Ø¯ÙŠØ¯" %}</h6>
    <form method="post"
          action="{% url 'core:attachment_add' %}"
          enctype="multipart/form-data"
          class="row g-2 align-items-end">
      {% csrf_token %}
      <input type="hidden" name="content_type" value="{{ attachment_content_type_id }}">
      <input type="hidden" name="object_id" value="{{ attachment_object_id }}">
      <input type="hidden" name="next" value="{{ attachment_next_url }}">

      <div class="col-md-4">
        <label class="form-label small" for="{{ attachment_form.file.id_for_label }}">
          {{ attachment_form.file.label }}
        </label>
        {{ attachment_form.file }}
        <div class="text-danger small">
          {{ attachment_form.file.errors }}
        </div>
      </div>

      <div class="col-md-3">
        <label class="form-label small" for="{{ attachment_form.title.id_for_label }}">
          {{ attachment_form.title.label }}
        </label>
        {{ attachment_form.title }}
        <div class="text-danger small">
          {{ attachment_form.title.errors }}
        </div>
      </div>

      <div class="col-md-4">
        <label class="form-label small" for="{{ attachment_form.description.id_for_label }}">
          {{ attachment_form.description.label }}
        </label>
        {{ attachment_form.description }}
        <div class="text-danger small">
          {{ attachment_form.description.errors }}
        </div>
      </div>

      <div class="col-md-1 d-grid">
        <button type="submit" class="btn btn-primary btn-sm">
          {% trans "Ø±ÙØ¹" %}
        </button>
      </div>
    </form>

  </div>
</div>
