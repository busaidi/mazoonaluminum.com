{% load i18n %}

{# ÙŠØªÙˆÙ‚Ø¹ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª:- invoice- attachments- attachments_count- attachment_form- invoice_add_attachment_url#}

<div class="card border-0 shadow-sm mb-3">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h5 class="card-title mb-1">
          {% trans "Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª" %}
          {% if attachments_count %}
            <span class="badge bg-light text-secondary">
              ğŸ“ {{ attachments_count }}
            </span>
          {% endif %}
        </h5>
        <p class="text-muted small mb-0">
          {% trans "Ù…Ù„ÙØ§Øª Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ø«Ù„ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±ØŒ Ø§Ù„Ø¹Ù‚ÙˆØ¯ØŒ Ø£Ùˆ Ø§Ù„ØµÙˆØ±." %}
        </p>
      </div>
    </div>

    {# Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª #}
    {% if attachments %}
      <div class="table-responsive mb-3">
        <table class="table table-sm align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>{% trans "Ø§Ù„Ù…Ù„Ù" %}</th>
              <th>{% trans "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" %}</th>
              <th>{% trans "Ø§Ù„ÙˆØµÙ" %}</th>
              <th>{% trans "ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨ÙˆØ§Ø³Ø·Ø©" %}</th>
              <th>{% trans "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±ÙØ¹" %}</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
          {% for att in attachments %}
            <tr>
              <td>
                {% with name=att.file.name|lower %}
  {% if name|slice:"-4:" == ".pdf" %}
    ğŸ“„
  {% elif name|slice:"-4:" == ".jpg" or name|slice:"-5:" == ".jpeg" or name|slice:"-4:" == ".png" %}
    ğŸ–¼ï¸
  {% else %}
    ğŸ“
  {% endif %}
{% endwith %}

                <a href="{{ att.file.url }}" target="_blank">
                  {{ att.title|default:att.file.name }}
                </a>
                <div class="small text-muted">
                  {{ att.file.size|filesizeformat }}
                </div>
              </td>
              <td>{{ att.title|default:"-" }}</td>
              <td class="small text-muted">{{ att.description|default:"-" }}</td>
              <td class="small">
                {% if att.uploaded_by %}
                  {{ att.uploaded_by.get_full_name|default:att.uploaded_by.username }}
                {% else %}
                  -
                {% endif %}
              </td>
              <td class="small text-muted">
                {{ att.uploaded_at|date:"Y-m-d H:i" }}
              </td>
              <td class="text-end">
                <form method="post"
                      action="{% url 'accounting:invoice_delete_attachment' invoice.number att.pk %}">
                  {% csrf_token %}
                  <button type="submit"
                          class="btn btn-sm btn-outline-danger"
                          onclick="return confirm('{% trans "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙÙ‚ØŸ" %}');">
                    ğŸ—‘ï¸
                  </button>
                </form>
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-muted small mb-3">
        {% trans "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±ÙÙ‚Ø§Øª Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†." %}
      </p>
    {% endif %}

    {# ÙÙˆØ±Ù… Ø±ÙØ¹ Ù…Ø±ÙÙ‚ Ø¬Ø¯ÙŠØ¯ #}
    <form method="post"
          action="{{ invoice_add_attachment_url }}"
          enctype="multipart/form-data"
          class="border-top pt-3 mt-3">
      {% csrf_token %}

      <div class="row g-3 align-items-end">
        <div class="col-md-4">
          <label class="form-label" for="{{ attachment_form.file.id_for_label }}">
            {{ attachment_form.file.label }}
          </label>
          {{ attachment_form.file }}
          {{ attachment_form.file.errors }}
        </div>

        <div class="col-md-3">
          <label class="form-label" for="{{ attachment_form.title.id_for_label }}">
            {{ attachment_form.title.label }}
          </label>
          {{ attachment_form.title }}
          {{ attachment_form.title.errors }}
        </div>

        <div class="col-md-3">
          <label class="form-label" for="{{ attachment_form.description.id_for_label }}">
            {{ attachment_form.description.label }}
          </label>
          {{ attachment_form.description }}
          {{ attachment_form.description.errors }}
        </div>

        <div class="col-md-2 d-grid">
          <button type="submit" class="btn btn-outline-primary">
            {% trans "Ø±ÙØ¹ Ù…Ø±ÙÙ‚" %}
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
