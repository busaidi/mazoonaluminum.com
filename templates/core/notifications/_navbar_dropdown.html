{% load i18n %}

{% if user.is_authenticated %}
<li class="nav-item dropdown">
  <a class="nav-link position-relative"
     href="#"
     id="navbarNotificationsDropdown"
     role="button"
     data-bs-toggle="dropdown"
     aria-expanded="false">
    <i class="bi bi-bell"></i>

    {% if notif_unread_count %}
      <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
        {{ notif_unread_count }}
      </span>
    {% endif %}
  </a>

  <div class="dropdown-menu dropdown-menu-end shadow-sm border-0 p-0"
       aria-labelledby="navbarNotificationsDropdown"
       style="min-width: 320px;">

    <div class="d-flex justify-content-between align-items-center px-3 py-2 border-bottom bg-light">
      <span class="fw-semibold small">
        {% trans "الإشعارات" %}
      </span>

      {% if notif_unread_count %}
        <form method="post" action="{% url 'core:notification_mark_all_read' %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-link btn-sm p-0 small">
            {% trans "تعليم الكل كمقروء" %}
          </button>
        </form>
      {% endif %}
    </div>

    {% if notif_recent %}
      <div class="list-group list-group-flush small">
        {% for n in notif_recent %}
          <a href="{% url 'core:notification_read_redirect' n.public_id %}"
             class="list-group-item list-group-item-action d-flex gap-2 {% if not n.is_read %}fw-semibold{% endif %}">
            <div class="mt-1">
              <span class="badge rounded-pill {{ n.bootstrap_level_class }}">
                {{ n.get_level_display }}
              </span>
            </div>
            <div class="flex-grow-1">
              <div class="mb-0">
                <i class="bi {{ n.icon_name }} me-1"></i>
                {{ n.verb }}
              </div>
              <div class="text-muted xsmall">
                {{ n.created_at|date:"Y-m-d H:i" }}
              </div>
            </div>
          </a>
        {% endfor %}
      </div>

      <div class="border-top text-center py-2">
        <a href="{% url 'core:notification_list' %}" class="small">
          {% trans "عرض كل الإشعارات" %}
        </a>
      </div>
    {% else %}
      <div class="p-3 text-center small text-muted">
        {% trans "لا توجد إشعارات حالياً." %}
      </div>
    {% endif %}
  </div>
</li>
{% endif %}
