{% extends "base.html" %}
{% load i18n %}

{# ================== SEO BLOCKS ================== #}

{% block meta_title %}
  {{ post.meta_title|default:post.title }}
{% endblock %}

{% block meta_description %}
  {{ post.meta_description|default:post.body|striptags|truncatechars:180 }}
{% endblock %}

{% block og_title %}
  {{ post.meta_title|default:post.title }}
{% endblock %}

{% block og_description %}
  {{ post.meta_description|default:post.body|striptags|truncatechars:180 }}
{% endblock %}

{% block og_type %}article{% endblock %}
{% block og_url %}{{ request.build_absolute_uri }}{% endblock %}
{% block og_image %}{% if og_image_url %}{{ og_image_url }}{% endif %}{% endblock %}

{% block twitter_card %}summary_large_image{% endblock %}
{% block twitter_title %}
  {{ post.meta_title|default:post.title }}
{% endblock %}
{% block twitter_description %}
  {{ post.meta_description|default:post.body|striptags|truncatechars:180 }}
{% endblock %}
{% block twitter_image %}{% if og_image_url %}{{ og_image_url }}{% endif %}{% endblock %}

{# Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ #}
{% block title %}
  {{ post.meta_title|default:post.title }}
{% endblock %}

{# ================== PAGE CONTENT ================== #}
{% block content %}
<div class="row g-4">

  {# ======== Ø§Ù„Ù…Ù‚Ø§Ù„ ======== #}
  <div class="col-lg-8">
    <article class="mb-4">

      <header classmb-3">
        <h1 class="h3 fw-bold mb-2 text-mazoon">
          {{ post.title }}
        </h1>

        <div class="d-flex flex-wrap gap-2 align-items-center text-muted small">
          <span>ğŸ“… {{ post.published_at|date:"Y-m-d H:i" }}</span>
          <span>â€¢</span>
          <span>
            {% blocktrans count count=comments|length %}
              ØªØ¹Ù„ÙŠÙ‚ ÙˆØ§Ø­Ø¯
            {% plural %}
              {{ count }} ØªØ¹Ù„ÙŠÙ‚Ø§Øª
            {% endblocktrans %}
          </span>
        </div>

        {% with tags=post.tags.all %}
          {% if tags %}
            <div class="mt-2 small">
              <span class="text-muted">{% trans "Ø§Ù„ÙˆØ³ÙˆÙ…" %}:</span>
              {% for tag in tags %}
                <span class="badge bg-light text-muted border ms-1">
                  #{{ tag.name }}
                </span>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}
      </header>

      <div class="card border-0 shadow-sm mb-4">
        <div class="card-body small" style="line-height: 1.9;">
          {{ post.body|linebreaks }}
        </div>
      </div>
    </article>

    {# ======== Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ======== #}
    <section class="mb-4" id="comments">
      <h2 class="h5 fw-bold mb-3">
        {% blocktrans count count=comments|length %}
          ØªØ¹Ù„ÙŠÙ‚ ÙˆØ§Ø­Ø¯
        {% plural %}
          {{ count }} ØªØ¹Ù„ÙŠÙ‚Ø§Øª
        {% endblocktrans %}
      </h2>

      {% if comments %}
        <div class="list-group mb-3">
          {% for c in comments %}
            <div class="list-group-item">
              <div class="d-flex justify-content-between align-items-center mb-1">
                <strong>{{ c.name }}</strong>
                <span class="small text-muted">
                  {{ c.created_at|date:"Y-m-d H:i" }}
                </span>
              </div>
              <p class="mb-1 small" style="white-space: pre-wrap;">
                {{ c.content }}
              </p>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-muted small mb-3">
          {% trans "Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¨Ø¹Ø¯. ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ¹Ù„Ù‚ Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„ØªØ¯ÙˆÙŠÙ†Ø©." %}
        </p>
      {% endif %}
    </section>

    {# ======== Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚ ======== #}
    <section id="add-comment">
      <h2 class="h5 fw-bold mb-3">{% trans "Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚Ø§Ù‹" %}</h2>

      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <form method="post" class="row g-3">
            {% csrf_token %}

            <div class="col-md-6">
              <label class="form-label small fw-semibold">
                {% trans "Ø§Ù„Ø§Ø³Ù…" %}
              </label>
              <input type="text"
                     name="name"
                     class="form-control form-control-sm"
                     required>
            </div>

            <div class="col-md-6">
              <label class="form-label small fw-semibold">
                {% trans "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" %}
              </label>
              <input type="email"
                     name="email"
                     class="form-control form-control-sm">
            </div>

            <div class="col-12">
              <label class="form-label small fw-semibold">
                {% trans "Ø§Ù„ØªØ¹Ù„ÙŠÙ‚" %}
              </label>
              <textarea name="content"
                        rows="4"
                        class="form-control form-control-sm"
                        required></textarea>
            </div>

            <div class="col-12 d-flex justify-content-end">
              <button type="submit" class="btn btn-primary">
                {% trans "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚" %}
              </button>
            </div>
          </form>
        </div>
      </div>
    </section>
  </div>

  {# ======== Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ ======== #}
  <div class="col-lg-4">
    <aside class="position-sticky" style="top: 80px;">

      <div class="card border-0 shadow-sm mb-3">
        <div class="card-body">
          <h2 class="h6 fw-bold mb-2 text-mazoon">{% trans "Ø¹Ù† Ù‡Ø°Ù‡ Ø§Ù„ØªØ¯ÙˆÙŠÙ†Ø©" %}</h2>
          <p class="small text-muted mb-0">
            {% trans "ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØµÙ Ù…Ø®ØªØµØ±ØŒ Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªÙ‚Ù†ÙŠØ©ØŒ Ø£Ùˆ Ø±ÙˆØ§Ø¨Ø· Ù„ØªØ¯ÙˆÙŠÙ†Ø§Øª Ù…Ø±ØªØ¨Ø·Ø©." %}
          </p>
        </div>
      </div>

      <div class="card border-0 shadow-sm">
        <div class="card-body small text-muted">
          <strong class="d-block mb-1 text-mazoon">{% trans "Ù…Ù„Ø§Ø­Ø¸Ø©" %}:</strong>
          <p class="mb-0">
            {% trans "Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ù‡Ù†Ø§ Ø¨Ø³ÙŠØ·ØŒ ÙˆÙŠÙ…ÙƒÙ† Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø±Ø¨Ø·Ù‡ Ø¨Ù†Ø¸Ø§Ù… Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø£Ùˆ Ù…ÙˆØ§ÙÙ‚Ø© ÙŠØ¯ÙˆÙŠØ© Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…." %}
          </p>
        </div>
      </div>

    </aside>
  </div>
</div>
{% endblock %}
