{% extends "accounting/base_accounting.html" %}
{% load i18n humanize %}

{# ğŸ‘ˆ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù„ÙˆÙƒ Ù‡Ùˆ Ø§Ù„Ù„ÙŠ ÙŠØºÙŠÙ‘Ø± <title> ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆÙŠØ­Ù‚Ù‚ Ø§Ù„ØªØ³Øª #}
{% block meta_title %}Trial Balance | Mazoon Aluminum{% endblock %}

{% block accounting_content %}

{# ===== Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ===== #}
<div class="mb-3 d-flex flex-wrap justify-content-between align-items-center gap-2">
  <div>
    <h2 class="h5 mb-1 fw-bold">
      {% trans "Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©" %}
      <span class="visually-hidden">Trial Balance</span>
    </h2>
    <p class="text-muted small mb-0">
      {% trans "ØªØ¬Ù…ÙŠØ¹ Ø£Ø±ØµØ¯Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª (Ù…Ø¯ÙŠÙ† / Ø¯Ø§Ø¦Ù†) Ø­Ø³Ø¨ Ø§Ù„ÙØªØ±Ø© Ø£Ùˆ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©." %}
    </p>
  </div>
</div>

{# ===== Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ÙÙˆØ±Ù… (Ø¥Ù† ÙˆØ¬Ø¯Øª) ===== #}
{% if form.errors %}
  <div class="alert alert-danger small">
    {% if form.non_field_errors %}
      <div class="mb-1">
        {{ form.non_field_errors }}
      </div>
    {% endif %}
    <ul class="mb-0">
      {% for field in form %}
        {% for error in field.errors %}
          <li>
            <strong>{{ field.label }}:</strong> {{ error }}
          </li>
        {% endfor %}
      {% endfor %}
    </ul>
  </div>
{% endif %}

{# ===== Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ÙÙ„ØªØ±Ø© Ø¯Ø§Ø®Ù„ ÙƒØ±Øª ===== #}
<div class="card shadow-sm border-0 mb-4">
  <div class="card-body">
    <form method="get" class="row g-2 align-items-end">

      <div class="col-md-3 col-sm-6">
        <label class="form-label form-label-sm mb-1">
          {% trans "Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©" %}
        </label>
        {{ form.fiscal_year }}
      </div>

      <div class="col-md-3 col-sm-6">
        <label class="form-label form-label-sm mb-1">
          {% trans "Ù…Ù† ØªØ§Ø±ÙŠØ®" %}
        </label>
        {{ form.date_from }}
      </div>

      <div class="col-md-3 col-sm-6">
        <label class="form-label form-label-sm mb-1">
          {% trans "Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®" %}
        </label>
        {{ form.date_to }}
      </div>

      <div class="col-md-3 col-sm-6 d-flex gap-2">
        <button type="submit" class="btn btn-primary btn-sm mt-auto">
          {% trans "ØªØµÙÙŠØ©" %}
        </button>
        <a href="{% url 'accounting:trial_balance' %}"
           class="btn btn-outline-secondary btn-sm mt-auto">
          {% trans "Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†" %}
        </a>
      </div>

    </form>
  </div>
</div>

{# ===== Ø¬Ø¯ÙˆÙ„ Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ===== #}
{% if rows %}
  <div class="card shadow-sm border-0">
    <div class="card-body">
      <div class="d-flex flex-wrap justify-content-between align-items-center mb-2 gap-2">
        <div>
          <h3 class="h6 mb-1 fw-bold">{% trans "Ù†ØªØ§Ø¦Ø¬ Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©" %}</h3>
          <p class="text-muted small mb-0">
            {% blocktrans with count=rows|length %}
              Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙÙŠ Ø§Ù„Ù…ÙŠØ²Ø§Ù†: {{ count }}
            {% endblocktrans %}
          </p>
        </div>

        {% if totals %}
          <div class="small text-end">
            <span class="me-2">
              <strong>{% trans "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙŠÙ†" %}:</strong>
              {{ totals.total_debit|default_if_none:"0.000"|intcomma }}
            </span>
            <span class="me-2">
              <strong>{% trans "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø§Ø¦Ù†" %}:</strong>
              {{ totals.total_credit|default_if_none:"0.000"|intcomma }}
            </span>

            {% if totals.total_debit == totals.total_credit %}
              <span class="badge bg-success">
                {% trans "Ù…ÙŠØ²Ø§Ù† Ù…ØªÙˆØ§Ø²Ù†" %}
              </span>
            {% else %}
              <span class="badge bg-warning text-dark">
                {% trans "ØªÙ†Ø¨ÙŠÙ‡: Ø§Ù„Ù…ÙŠØ²Ø§Ù† ØºÙŠØ± Ù…ØªÙˆØ§Ø²Ù†" %}
              </span>
            {% endif %}
          </div>
        {% endif %}
      </div>

      <div class="table-responsive">
        <table class="table table-sm table-striped align-middle mb-0">
          <thead class="table-light small text-muted">
            <tr>
              <th class="text-nowrap">{% trans "Ø§Ù„ÙƒÙˆØ¯" %}</th>
              <th class="text-nowrap">{% trans "Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨" %}</th>
              <th class="text-nowrap">{% trans "Ø§Ù„Ù†ÙˆØ¹" %}</th>
              <th class="text-end text-nowrap">{% trans "Ù…Ø¯ÙŠÙ†" %}</th>
              <th class="text-end text-nowrap">{% trans "Ø¯Ø§Ø¦Ù†" %}</th>
            </tr>
          </thead>
          <tbody>
          {% for row in rows %}
            <tr>
              <td class="text-nowrap small">
                {{ row.account__code }}
              </td>
              <td class="text-nowrap small">
                {{ row.account__name }}
              </td>
              <td class="text-nowrap small">
                {% if row.account__type == "asset" %}
                  {% trans "Ø£ØµÙ„" %}
                {% elif row.account__type == "liability" %}
                  {% trans "Ø§Ù„ØªØ²Ø§Ù…Ø§Øª" %}
                {% elif row.account__type == "equity" %}
                  {% trans "Ø­Ù‚ÙˆÙ‚ Ù…Ù„ÙƒÙŠØ©" %}
                {% elif row.account__type == "revenue" %}
                  {% trans "Ø¥ÙŠØ±Ø§Ø¯Ø§Øª" %}
                {% elif row.account__type == "expense" %}
                  {% trans "Ù…ØµØ±ÙˆÙØ§Øª" %}
                {% else %}
                  {{ row.account__type }}
                {% endif %}
              </td>
              <td class="text-end text-nowrap small">
                {{ row.debit|default_if_none:"0.000"|intcomma }}
              </td>
              <td class="text-end text-nowrap small">
                {{ row.credit|default_if_none:"0.000"|intcomma }}
              </td>
            </tr>
          {% endfor %}
          </tbody>

          {% if totals %}
            <tfoot class="small">
              <tr class="table-light fw-semibold">
                <td colspan="3" class="text-end text-nowrap">
                  {% trans "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ" %}
                </td>
                <td class="text-end text-nowrap">
                  {{ totals.total_debit|default_if_none:"0.000"|intcomma }}
                </td>
                <td class="text-end text-nowrap">
                  {{ totals.total_credit|default_if_none:"0.000"|intcomma }}
                </td>
              </tr>
            </tfoot>
          {% endif %}
        </table>
      </div>

      {% if totals %}
        <p class="mt-2 mb-0 small">
          {% if totals.total_debit == totals.total_credit %}
            <span class="text-success">
              {% trans "Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…ØªÙˆØ§Ø²Ù†: Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø¯ÙŠÙ† ÙŠØ³Ø§ÙˆÙŠ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¯Ø§Ø¦Ù†." %}
            </span>
          {% else %}
            <span class="text-danger">
              {% trans "ØªÙ†Ø¨ÙŠÙ‡: Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ØºÙŠØ± Ù…ØªÙˆØ§Ø²Ù†ØŒ ÙŠÙÙØ¶Ù‘Ù„ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù‚ÙŠÙˆØ¯." %}
            </span>
          {% endif %}
        </p>
      {% endif %}
    </div>
  </div>
{% else %}
  <p class="text-muted small">
    {% trans "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©. Ø¬Ø±Ù‘Ø¨ ØªØºÙŠÙŠØ± Ø§Ù„ÙØªØ±Ø© Ø£Ùˆ Ø§Ø®ØªÙŠØ§Ø± Ø³Ù†Ø© Ù…Ø§Ù„ÙŠØ© Ù…Ø®ØªÙ„ÙØ©." %}
  </p>
{% endif %}

{% endblock %}
