{% extends "base.html" %}

{% block title %}طلب #{{ order.id }}{% endblock %}

{% block content %}
<div class="container py-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4 mb-0">تفاصيل الطلب #{{ order.id }}</h1>
    <div class="d-flex gap-2">
      <a href="{% url 'accounting:order_list' %}" class="btn btn-secondary btn-sm">
        رجوع للطلبات
      </a>
      {% if order.invoice %}
        <a href="{% url 'accounting:invoice_detail' number=order.invoice.number %}" class="btn btn-outline-primary btn-sm">
          عرض الفاتورة المرتبطة
        </a>
      {% endif %}
    </div>
  </div>

  <div class="row g-3 mb-3">
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title">بيانات العميل</h5>
          <p class="mb-1"><strong>الاسم:</strong> {{ order.customer.name }}</p>
          {% if order.customer.company_name %}
          <p class="mb-1"><strong>الشركة:</strong> {{ order.customer.company_name }}</p>
          {% endif %}
          {% if order.customer.phone %}
          <p class="mb-1"><strong>الهاتف:</strong> {{ order.customer.phone }}</p>
          {% endif %}
          {% if order.customer.address %}
          <p class="mb-0"><strong>العنوان:</strong> {{ order.customer.address }}</p>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title">بيانات الطلب</h5>
          <p class="mb-1"><strong>رقم الطلب:</strong> {{ order.id }}</p>
          <p class="mb-1"><strong>التاريخ:</strong> {{ order.created_at|date:"Y-m-d H:i" }}</p>
          <p class="mb-1"><strong>الحالة:</strong> {{ order.get_status_display }}</p>
          <p class="mb-1"><strong>إجمالي الطلب:</strong> {{ order.total_amount }}</p>
          {% if order.invoice %}
          <p class="mb-0">
            <strong>الفاتورة المرتبطة:</strong>
            <a href="{% url 'accounting:invoice_detail' number=order.invoice.number %}">
              {{ order.invoice.number }}
            </a>
          </p>
          {% else %}
          <p class="mb-0 text-muted">لا توجد فاتورة مرتبطة بعد.</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {% if order.notes %}
  <div class="card mb-3">
    <div class="card-body">
      <h5 class="card-title">ملاحظات</h5>
      <p class="mb-0">{{ order.notes|linebreaksbr }}</p>
    </div>
  </div>
  {% endif %}

  <div class="card">
    <div class="card-body">
      <h5 class="card-title">بنود الطلب</h5>
      <table class="table table-sm align-middle mb-0">
        <thead>
          <tr>
            <th>المنتج</th>
            <th>الوصف</th>
            <th class="text-center">الكمية</th>
            <th class="text-center">الوحدة</th>
            <th class="text-end">سعر الوحدة</th>
            <th class="text-end">الإجمالي</th>
          </tr>
        </thead>
        <tbody>
          {% for line in order.lines.all %}
          <tr>
            <td>{{ line.product.name_ar }}</td>
            <td>{{ line.description }}</td>
            <td class="text-center">{{ line.quantity }}</td>
            <td class="text-center">{{ line.unit_label }}</td>
            <td class="text-end">{{ line.unit_price }}</td>
            <td class="text-end">{{ line.total }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted">
              لا توجد بنود في هذا الطلب.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</div>
{% endblock %}
