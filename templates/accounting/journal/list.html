{% extends "accounting/base_accounting.html" %}
{% load i18n humanize %}

{% block title %}{% trans "سجل قيود اليومية" %}{% endblock %}

{% block accounting_content %}

{# --- Header --- #}
<div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
  <div>
    <h4 class="fw-bold text-dark mb-1">{% trans "قيود اليومية" %}</h4>
    <p class="text-muted small mb-0">
      {% trans "سجل كافة العمليات المالية والقيود المحاسبية." %}
    </p>
  </div>
  <div>
    <a href="{% url 'accounting:journal_entry_create' %}"
       class="btn btn-dark btn-sm px-3">
      + {% trans "قيد جديد" %}
    </a>
  </div>
</div>

{# --- Filter --- #}
<div class="card border-0 shadow-sm mb-4">
  <div class="card-body p-2">
    <form method="get" class="row g-2 align-items-end">
      <div class="col-md-3">
        <label class="form-label small text-muted mb-1">
          {% trans "بحث (رقم/وصف)" %}
        </label>
        {{ filter_form.q }}
      </div>
      <div class="col-md-2">
        <label class="form-label small text-muted mb-1">
          {% trans "من تاريخ" %}
        </label>
        {{ filter_form.date_from }}
      </div>
      <div class="col-md-2">
        <label class="form-label small text-muted mb-1">
          {% trans "إلى تاريخ" %}
        </label>
        {{ filter_form.date_to }}
      </div>
      <div class="col-md-2">
        <label class="form-label small text-muted mb-1">
          {% trans "الحالة" %}
        </label>
        {{ filter_form.posted }}
      </div>
      <div class="col-md-2">
        <label class="form-label small text-muted mb-1">
          {% trans "الدفتر" %}
        </label>
        {{ filter_form.journal }}
      </div>
      <div class="col-md-1 d-grid">
        <button type="submit" class="btn btn-outline-dark btn-sm">
          {% trans "تصفية" %}
        </button>
      </div>
    </form>
  </div>
</div>

{# --- Table --- #}
<div class="card border-0 shadow-sm">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="bg-light small text-muted">
        <tr>
          <th>{% trans "رقم القيد" %}</th>
          <th>{% trans "التاريخ" %}</th>
          <th>{% trans "الدفتر" %}</th>
          <th>{% trans "البيان / الوصف" %}</th>
          <th class="text-end">{% trans "إجمالي المدين" %}</th>
          <th class="text-end">{% trans "إجمالي الدائن" %}</th>
          <th class="text-center">{% trans "الحالة" %}</th>
          <th class="text-end"></th>
        </tr>
      </thead>
      <tbody>
        {% for e in entries %}
          <tr onclick="window.location='{% url 'accounting:journal_entry_detail' e.pk %}';"
              style="cursor: pointer;">
            <td class="fw-bold text-dark font-monospace">
              {{ e.display_number }}
            </td>
            <td class="text-muted small">
              {{ e.date|date:"Y-m-d" }}
            </td>
            <td>
              <span class="badge bg-light text-dark border fw-normal">
                {{ e.journal.code }}
              </span>
            </td>
            <td class="small text-truncate"
                style="max-width: 250px;"
                title="{{ e.description }}">
              {{ e.description|default:"-" }}
              {% if e.reference %}
                <br>
                <span class="text-muted small">
                  Ref: {{ e.reference }}
                </span>
              {% endif %}
            </td>
            <td class="text-end fw-bold text-dark">
              {{ e.total_debit_value|intcomma }}
            </td>
            <td class="text-end fw-bold text-dark">
              {{ e.total_credit_value|intcomma }}
            </td>
            <td class="text-center">
              {% if e.posted %}
                <span class="badge bg-success-subtle text-success border border-success-subtle">
                  {% trans "مُرحّل" %}
                </span>
              {% else %}
                <span class="badge bg-secondary-subtle text-secondary border border-secondary-subtle">
                  {% trans "مسودة" %}
                </span>
              {% endif %}
            </td>
            <td class="text-end">
              <a href="{% url 'accounting:journal_entry_detail' e.pk %}"
                 class="btn btn-sm btn-link text-muted p-0">
                {% trans "عرض" %}
              </a>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="8" class="text-center py-5 text-muted">
              {% trans "لا توجد قيود مطابقة." %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {# Pagination #}
  {% if is_paginated %}
    <div class="card-footer bg-white border-top py-3">
      <nav>
        <ul class="pagination justify-content-center mb-0 small">
          {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link text-dark"
                 href="?page={{ page_obj.previous_page_number }}&{{ current_query }}">
                {% trans "السابق" %}
              </a>
            </li>
          {% endif %}
          <li class="page-item disabled">
            <span class="page-link text-muted">
              {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
            </span>
          </li>
          {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link text-dark"
                 href="?page={{ page_obj.next_page_number }}&{{ current_query }}">
                {% trans "التالي" %}
              </a>
            </li>
          {% endif %}
        </ul>
      </nav>
    </div>
  {% endif %}
</div>

{% endblock %}
