{% extends "base.html" %}

{# ุนููุงู ุงูุตูุญุฉ ูู ุงูุชุจููุจ + SEO #}
{% block meta_title %}ููุงุชูุฑ ุงูุนููุงุก | Mazoon Aluminum{% endblock %}
{% block meta_description %}
ูุงุฆูุฉ ููุงุชูุฑ ุงูุนููุงุก ูุน ุฅููุงููุฉ ุงูุชุตููุฉ ุญุณุจ ุญุงูุฉ ุงููุงุชูุฑุฉ ูุนุฑุถ ุงูุฑุตูุฏ ุงููุชุจูู ููู ูุงุชูุฑุฉ.
{% endblock %}

{% block content %}
<div class="py-4">

  <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
    <div>
      <h1 class="h3 mb-1">๐ ุงูููุงุชูุฑ</h1>
      <p class="text-muted small mb-0">
        ุนุฑุถ ูุฅุฏุงุฑุฉ ููุงุชูุฑ ุงูุนููุงุกุ ูุน ูุชุงุจุนุฉ ุงููุจุงูุบ ุงููุฏููุนุฉ ูุงููุชุจููุฉ.
      </p>
    </div>
    <a href="{% url 'accounting:invoice_create' %}" class="btn btn-primary btn-sm">
      + ูุงุชูุฑุฉ ุฌุฏูุฏุฉ
    </a>
  </div>

  {# ููุชุฑ ุงูุญุงูุฉ #}
  <form method="get" class="row g-2 mb-3 align-items-center">
    <div class="col-auto">
      <label for="id_status" class="form-label small mb-1">ุญุงูุฉ ุงููุงุชูุฑุฉ</label>
      <select id="id_status" name="status" class="form-select form-select-sm" onchange="this.form.submit()">
        <option value="">ูู ุงูุญุงูุงุช</option>
        {% for value,label in invoices.model.Status.choices %}
          <option value="{{ value }}" {% if status_filter == value %}selected{% endif %}>
            {{ label }}
          </option>
        {% endfor %}
      </select>
    </div>
  </form>

  <div class="card border-0 shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover table-sm mb-0 align-middle">
          <thead class="table-light">
            <tr>
              <th>ุฑูู ุงููุงุชูุฑุฉ</th>
              <th>ุงูุนููู</th>
              <th>ุงูุชุงุฑูุฎ</th>
              <th class="text-end">ุงูุฅุฌูุงูู</th>
              <th class="text-end">ุงููุฏููุน</th>
              <th class="text-end">ุงููุชุจูู</th>
              <th>ุงูุญุงูุฉ</th>
            </tr>
          </thead>
          <tbody>
            {% for inv in invoices %}
              <tr>
                <td>
                  <a href="{% url 'accounting:invoice_detail' number=inv.number %}">
                    {{ inv.number }}
                  </a>
                </td>
                <td>{{ inv.customer.name }}</td>
                <td>{{ inv.issued_at }}</td>
                <td class="text-end">{{ inv.total_amount }}</td>
                <td class="text-end">{{ inv.paid_amount }}</td>
                <td class="text-end">{{ inv.balance }}</td>
                <td>
                  {# ุดุงุฑุงุช ุจุณูุทุฉ ููุญุงูุฉ #}
                  {% if inv.status == inv.Status.PAID %}
                    <span class="badge bg-success">ูุฏููุนุฉ</span>
                  {% elif inv.status == inv.Status.PARTIALLY_PAID %}
                    <span class="badge bg-warning text-dark">ูุฏููุนุฉ ุฌุฒุฆูุงู</span>
                  {% elif inv.status == inv.Status.CANCELLED %}
                    <span class="badge bg-secondary">ููุบุงุฉ</span>
                  {% elif inv.status == inv.Status.SENT %}
                    <span class="badge bg-info text-dark">ูุฑุณูุฉ</span>
                  {% else %}
                    <span class="badge bg-light text-dark">{{ inv.get_status_display }}</span>
                  {% endif %}
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="7" class="text-center text-muted py-4">
                  ูุง ุชูุฌุฏ ููุงุชูุฑ ุญุชู ุงูุขู.
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    {# Pagination #}
    {% if is_paginated %}
      <div class="card-footer bg-body-tertiary">
        <nav aria-label="ุตูุญุงุช ุงูููุงุชูุฑ">
          <ul class="pagination justify-content-center mb-0">
            {% if page_obj.has_previous %}
              <li class="page-item">
                <a class="page-link"
                   href="?page={{ page_obj.previous_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}">
                  ุงูุณุงุจู
                </a>
              </li>
            {% else %}
              <li class="page-item disabled">
                <span class="page-link">ุงูุณุงุจู</span>
              </li>
            {% endif %}

            <li class="page-item disabled">
              <span class="page-link">
                ุตูุญุฉ {{ page_obj.number }} ูู {{ page_obj.paginator.num_pages }}
              </span>
            </li>

            {% if page_obj.has_next %}
              <li class="page-item">
                <a class="page-link"
                   href="?page={{ page_obj.next_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}">
                  ุงูุชุงูู
                </a>
              </li>
            {% else %}
              <li class="page-item disabled">
                <span class="page-link">ุงูุชุงูู</span>
              </li>
            {% endif %}
          </ul>
        </nav>
      </div>
    {% endif %}
  </div>

</div>
{% endblock %}
