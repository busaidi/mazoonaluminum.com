{% extends "accounting/base_accounting.html" %}
{% load i18n %}

{# Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø© ÙÙŠ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ + SEO #}
{% block meta_title %}
  {% if invoice_type == 'purchase' %}
    {% trans "ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª" %} | Mazoon Aluminum
  {% elif invoice_type == 'sales' %}
    {% trans "ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª" %} | Mazoon Aluminum
  {% else %}
    {% trans "Ø§Ù„ÙÙˆØ§ØªÙŠØ±" %} | Mazoon Aluminum
  {% endif %}
{% endblock %}

{% block meta_description %}
  {% if invoice_type == 'purchase' %}
    {% trans "Ù‚Ø§Ø¦Ù…Ø© ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„ÙƒÙ„ ÙØ§ØªÙˆØ±Ø©." %}
  {% elif invoice_type == 'sales' %}
    {% trans "Ù‚Ø§Ø¦Ù…Ø© ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„ÙƒÙ„ ÙØ§ØªÙˆØ±Ø©." %}
  {% else %}
    {% trans "Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„ÙƒÙ„ ÙØ§ØªÙˆØ±Ø©." %}
  {% endif %}
{% endblock %}

{% block accounting_content %}
<div class="py-4">

  {# Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© #}
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
    <div>
      <h1 class="h4 mb-1 text-mazoon">
        ğŸ“„
        {% if invoice_type == 'purchase' %}
          {% trans "ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª" %}
        {% elif invoice_type == 'sales' %}
          {% trans "ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª" %}
        {% else %}
          {% trans "Ø§Ù„ÙÙˆØ§ØªÙŠØ±" %}
        {% endif %}
      </h1>
      <p class="text-muted small mb-0">
        {% if invoice_type == 'purchase' %}
          {% trans "Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§ØªØŒ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø© ÙˆØ§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù„ÙƒÙ„ ÙØ§ØªÙˆØ±Ø©." %}
        {% elif invoice_type == 'sales' %}
          {% trans "Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§ØªØŒ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø© ÙˆØ§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù„ÙƒÙ„ ÙØ§ØªÙˆØ±Ø©." %}
        {% else %}
          {% trans "Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ±ØŒ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø© ÙˆØ§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù„ÙƒÙ„ ÙØ§ØªÙˆØ±Ø©." %}
        {% endif %}
      </p>
    </div>

    {# Ø²Ø± Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ #}
    {% if invoice_type == 'purchase' %}
      <a href="{% url 'accounting:purchase_invoice_create' %}"
         class="btn btn-primary btn-sm d-flex align-items-center gap-1">
        <span class="fw-semibold">+ {% trans "ÙØ§ØªÙˆØ±Ø© Ù…Ø´ØªØ±ÙŠØ§Øª Ø¬Ø¯ÙŠØ¯Ø©" %}</span>
      </a>
    {% elif invoice_type == 'sales' %}
      <a href="{% url 'accounting:sales_invoice_create' %}"
         class="btn btn-primary btn-sm d-flex align-items-center gap-1">
        <span class="fw-semibold">+ {% trans "ÙØ§ØªÙˆØ±Ø© Ù…Ø¨ÙŠØ¹Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©" %}</span>
      </a>
    {% else %}
      <a href="{% url 'accounting:invoice_create' %}"
         class="btn btn-primary btn-sm d-flex align-items-center gap-1">
        <span class="fw-semibold">+ {% trans "ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©" %}</span>
      </a>
    {% endif %}
  </div>

  {# ÙÙ„ØªØ± Ø§Ù„Ø­Ø§Ù„Ø© Ø¯Ø§Ø®Ù„ ÙƒØ±Øª Ù†Ø¸ÙŠÙ #}
  <form method="get" class="mb-3">
    <div class="card bg-mazoon-card border-0 shadow-sm">
      <div class="card-body py-2">
        <div class="row g-2 align-items-end">
          <div class="col-auto">
            <label for="id_status" class="form-label small mb-1">{% trans "Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©" %}</label>
            <select id="id_status"
                    name="status"
                    class="form-select form-select-sm"
                    onchange="this.form.submit()">
              <option value="">{% trans "ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª" %}</option>
              {% for value,label in invoices.model.Status.choices %}
                <option value="{{ value }}" {% if status_filter == value %}selected{% endif %}>
                  {{ label }}
                </option>
              {% endfor %}
            </select>
          </div>
        </div>
      </div>
    </div>
  </form>

  <div class="card border-0 shadow-sm bg-mazoon-card">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover table-sm mb-0 align-middle">
          <thead class="table-light small">
            <tr>
              <th>{% trans "Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©" %}</th>
              <th>
                {% if invoice_type == 'purchase' %}
                  {% trans "Ø§Ù„Ù…ÙˆØ±Ø¯" %}
                {% else %}
                  {% trans "Ø§Ù„Ø¹Ù…ÙŠÙ„" %}
                {% endif %}
              </th>
              <th>{% trans "Ø§Ù„ØªØ§Ø±ÙŠØ®" %}</th>
              <th class="text-end">{% trans "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ" %}</th>
              <th class="text-end">{% trans "Ø§Ù„Ù…Ø¯ÙÙˆØ¹" %}</th>
              <th class="text-end">{% trans "Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ" %}</th>
              <th>{% trans "Ø§Ù„Ø­Ø§Ù„Ø©" %}</th>
            </tr>
          </thead>
          <tbody>
            {% for inv in invoices %}
              <tr>
                <td>
                  {# Ù†Ø­Ø¯Ø¯ Ø±Ø§Ø¨Ø· Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„ÙØ¹Ù„ÙŠ #}
                  {% if inv.type == 'purchase' %}
                    {% url 'accounting:purchase_invoice_detail' inv.pk as inv_detail_url %}
                  {% elif inv.type == 'sales' %}
                    {% url 'accounting:sales_invoice_detail' inv.pk as inv_detail_url %}
                  {% else %}
                    {% url 'accounting:invoice_detail' inv.pk as inv_detail_url %}
                  {% endif %}

                  {% if inv.number %}
                    <a href="{{ inv_detail_url }}"
                       class="text-decoration-none text-mazoon fw-semibold">
                      {{ inv.number }}
                    </a>
                  {% else %}
                    <a href="{{ inv_detail_url }}"
                       class="text-decoration-none text-muted small">
                      {% trans "Ø¨Ø¯ÙˆÙ† Ø±Ù‚Ù…" %} (ID: {{ inv.id }})
                    </a>
                  {% endif %}
                </td>

                <td>
                  {{ inv.customer|default:"-" }}
                </td>

                <td>
                  {{ inv.issued_at|date:"d/m/Y" }}
                </td>

                <td class="text-end fw-semibold">
                  {{ inv.total_amount }}
                </td>

                <td class="text-end">
                  {{ inv.paid_amount }}
                </td>

                <td class="text-end">
                  {{ inv.balance }}
                </td>

                <td>
                  {% if inv.status == inv.Status.PAID %}
                    <span class="badge-mazoon badge-paid">{% trans "Ù…Ø¯ÙÙˆØ¹Ø©" %}</span>
                  {% elif inv.status == inv.Status.PARTIALLY_PAID %}
                    <span class="badge-mazoon badge-partially-paid">{% trans "Ù…Ø¯ÙÙˆØ¹Ø© Ø¬Ø²Ø¦ÙŠØ§Ù‹" %}</span>
                  {% elif inv.status == inv.Status.CANCELLED %}
                    <span class="badge-mazoon badge-cancelled">{% trans "Ù…Ù„ØºØ§Ø©" %}</span>
                  {% elif inv.status == inv.Status.SENT %}
                    <span class="badge-mazoon badge-sent">{% trans "Ù…Ø±Ø³Ù„Ø©" %}</span>
                  {% else %}
                    <span class="badge-mazoon badge-draft">
                      {{ inv.get_status_display }}
                    </span>
                  {% endif %}
                </td>
              </tr>

            {% empty %}
              <tr>
                <td colspan="7" class="text-center text-muted py-4">
                  {% if invoice_type == 'purchase' %}
                    {% trans "Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ù…Ø´ØªØ±ÙŠØ§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†." %}
                  {% elif invoice_type == 'sales' %}
                    {% trans "Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ù…Ø¨ÙŠØ¹Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†." %}
                  {% else %}
                    {% trans "Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†." %}
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    {# Pagination #}
    {% if is_paginated %}
      <div class="card-footer bg-body-tertiary">
        <nav aria-label="{% trans 'ØµÙØ­Ø§Øª Ø§Ù„ÙÙˆØ§ØªÙŠØ±' %}">
          <ul class="pagination justify-content-center mb-0 small">

            {% if page_obj.has_previous %}
              <li class="page-item">
                <a class="page-link"
                   href="?page={{ page_obj.previous_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}">
                  {% trans "Ø§Ù„Ø³Ø§Ø¨Ù‚" %}
                </a>
              </li>
            {% else %}
              <li class="page-item disabled">
                <span class="page-link">{% trans "Ø§Ù„Ø³Ø§Ø¨Ù‚" %}</span>
              </li>
            {% endif %}

            <li class="page-item disabled">
              <span class="page-link">
                {% blocktrans %}ØµÙØ­Ø© {{ page_obj.number }} Ù…Ù† {{ page_obj.paginator.num_pages }}{% endblocktrans %}
              </span>
            </li>

            {% if page_obj.has_next %}
              <li class="page-item">
                <a class="page-link"
                   href="?page={{ page_obj.next_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}">
                  {% trans "Ø§Ù„ØªØ§Ù„ÙŠ" %}
                </a>
              </li>
            {% else %}
              <li class="page-item disabled">
                <span class="page-link">{% trans "Ø§Ù„ØªØ§Ù„ÙŠ" %}</span>
              </li>
            {% endif %}

          </ul>
        </nav>
      </div>
    {% endif %}
  </div>

</div>
{% endblock %}
