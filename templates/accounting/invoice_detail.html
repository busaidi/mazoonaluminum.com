{% extends "base.html" %}

{% block meta_title %}ÙØ§ØªÙˆØ±Ø© {{ invoice.number }} | Mazoon Aluminum{% endblock %}
{% block meta_description %}
ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù… {{ invoice.number }} Ù„Ù„Ø¹Ù…ÙŠÙ„ {{ invoice.customer.name }}ØŒ Ù…Ø¹ Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© ÙˆØ§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ.
{% endblock %}

{% block content %}
<div class="py-4">

  <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
    <div>
      <h1 class="h3 mb-1">ÙØ§ØªÙˆØ±Ø© {{ invoice.number }}</h1>
      <p class="text-muted small mb-0">
        Ø¹Ù…ÙŠÙ„: {{ invoice.customer.name }}
      </p>
    </div>
    <div class="d-flex flex-wrap gap-2">
      <a href="{% url 'accounting:invoice_add_payment' number=invoice.number %}"
         class="btn btn-success btn-sm">
        + Ø¥Ø¶Ø§ÙØ© Ø¯ÙØ¹Ø©
      </a>
      <a href="{% url 'accounting:invoice_print' number=invoice.number %}"
         class="btn btn-outline-secondary btn-sm"
         target="_blank">
        Ø·Ø¨Ø§Ø¹Ø© / PDF
      </a>
      <a href="{% url 'accounting:invoice_list' %}" class="btn btn-secondary btn-sm">
        Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
      </a>
    </div>
  </div>

  <div class="row g-3 mb-3">
    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <h5 class="card-title mb-3">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h5>
          <p class="mb-1 fw-semibold">{{ invoice.customer.name }}</p>

          {% if invoice.customer.company_name %}
            <p class="mb-1 text-muted small">{{ invoice.customer.company_name }}</p>
          {% endif %}

          {% if invoice.customer.phone %}
            <p class="mb-1">
              <span class="text-muted small">ğŸ“</span>
              <span class="small">{{ invoice.customer.phone }}</span>
            </p>
          {% endif %}

          {% if invoice.customer.email %}
            <p class="mb-0">
              <span class="text-muted small">âœ‰</span>
              <span class="small">{{ invoice.customer.email }}</span>
            </p>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <h5 class="card-title mb-3">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h5>
          <p class="mb-1 small">
            <span class="text-muted">Ø§Ù„ØªØ§Ø±ÙŠØ®:</span>
            <span class="fw-semibold">{{ invoice.issued_at }}</span>
          </p>
          <p class="mb-1 small">
            <span class="text-muted">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚:</span>
            <span class="fw-semibold">{{ invoice.due_date|default:"-" }}</span>
          </p>
          <p class="mb-0 small">
            <span class="text-muted">Ø§Ù„Ø­Ø§Ù„Ø©:</span>
            {% if invoice.status == invoice.Status.PAID %}
              <span class="badge bg-success ms-1">Ù…Ø¯ÙÙˆØ¹Ø©</span>
            {% elif invoice.status == invoice.Status.PARTIALLY_PAID %}
              <span class="badge bg-warning text-dark ms-1">Ù…Ø¯ÙÙˆØ¹Ø© Ø¬Ø²Ø¦ÙŠØ§Ù‹</span>
            {% elif invoice.status == invoice.Status.CANCELLED %}
              <span class="badge bg-secondary ms-1">Ù…Ù„ØºØ§Ø©</span>
            {% elif invoice.status == invoice.Status.SENT %}
              <span class="badge bg-info text-dark ms-1">Ù…Ø±Ø³Ù„Ø©</span>
            {% else %}
              <span class="badge bg-light text-dark ms-1">
                {{ invoice.get_status_display }}
              </span>
            {% endif %}
          </p>
        </div>
      </div>
    </div>
  </div>

  <div class="card border-0 shadow-sm mb-3">
    <div class="card-body">
      <h5 class="card-title mb-3">Ø§Ù„Ù…Ø¨Ø§Ù„Øº</h5>
      <div class="row">
        <div class="col-md-4 col-sm-6 mb-2">
          <div class="small text-muted mb-1">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
          <div class="fw-semibold">{{ invoice.total_amount }}</div>
        </div>
        <div class="col-md-4 col-sm-6 mb-2">
          <div class="small text-muted mb-1">Ø§Ù„Ù…Ø¯ÙÙˆØ¹</div>
          <div class="fw-semibold">{{ invoice.paid_amount }}</div>
        </div>
        <div class="col-md-4 col-sm-6 mb-2">
          <div class="small text-muted mb-1">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
          <div class="fw-semibold">{{ invoice.balance }}</div>
        </div>
      </div>
    </div>
  </div>

  {% if invoice.description %}
    <div class="card border-0 shadow-sm mb-3">
      <div class="card-body">
        <h5 class="card-title mb-3">Ø§Ù„ÙˆØµÙ</h5>
        <p class="mb-0 small">{{ invoice.description|linebreaks }}</p>
      </div>
    </div>
  {% endif %}

  <div class="card border-0 shadow-sm">
    <div class="card-body">
      <h5 class="card-title mb-3">Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©</h5>
      <div class="table-responsive">
        <table class="table table-sm align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
              <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
              <th>Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©</th>
              <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
            </tr>
          </thead>
          <tbody>
            {% for p in invoice.payments.all %}
              <tr>
                <td>{{ p.date }}</td>
                <td>{{ p.amount }}</td>
                <td>{{ p.get_method_display }}</td>
                <td>{{ p.notes }}</td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="4" class="text-muted text-center small py-3">
                  Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙØ¹Ø§Øª Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©.
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>
{% endblock %}
