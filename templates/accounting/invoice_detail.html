{% extends "base.html" %}
{% load i18n %}

{% block meta_title %}
    {% blocktrans with number=invoice.number %}ÙØ§ØªÙˆØ±Ø© {{ number }} | Mazoon Aluminum{% endblocktrans %}
{% endblock %}

{% block meta_description %}
    {% blocktrans with number=invoice.number customer=invoice.customer.name %}
        ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù… {{ number }} Ù„Ù„Ø¹Ù…ÙŠÙ„ {{ customer }}ØŒ Ù…Ø¹ Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ù†ÙˆØ¯ ÙˆØ§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© ÙˆØ§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ.
    {% endblocktrans %}
{% endblock %}

{% block content %}
    <div class="py-4">

        <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
            <div>
                <h1 class="h3 mb-1">
                    {% blocktrans with number=invoice.number %}ÙØ§ØªÙˆØ±Ø© {{ number }}{% endblocktrans %}
                </h1>
                <p class="text-muted small mb-0">
                    {% blocktrans with name=invoice.customer.name %}Ø¹Ù…ÙŠÙ„: {{ name }}{% endblocktrans %}
                </p>
            </div>
            <div class="d-flex flex-wrap gap-2">
                <a href="{% url 'accounting:invoice_update' number=invoice.number %}"
                   class="btn btn-primary btn-sm">
                    {% trans "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©" %}
                </a>
                {# ğŸ‘‡ Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù† ÙƒØ§Ù†Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø·Ù„Ø¨ #}
                {% if invoice.order %}
                    <a href="{% url 'accounting:order_detail' pk=invoice.order.pk %}"
                       class="btn btn-outline-primary btn-sm">
                        {% trans "Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨" %}
                    </a>
                {% endif %}



                <a href="{% url 'accounting:invoice_add_payment' number=invoice.number %}"
                   class="btn btn-success btn-sm">
                    {% trans "+ Ø¥Ø¶Ø§ÙØ© Ø¯ÙØ¹Ø©" %}
                </a>
                <a href="{% url 'accounting:invoice_print' number=invoice.number %}"
                   class="btn btn-outline-secondary btn-sm"
                   target="_blank">
                    {% trans "Ø·Ø¨Ø§Ø¹Ø© / PDF" %}
                </a>
                <a href="{% url 'accounting:invoice_list' %}" class="btn btn-secondary btn-sm">
                    {% trans "Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©" %}
                </a>
            </div>
        </div>

        <div class="row g-3 mb-3">
            <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
            <div class="col-md-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <h5 class="card-title mb-3">{% trans "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„" %}</h5>
                        <p class="mb-1 fw-semibold">{{ invoice.customer.name }}</p>

                        {% if invoice.customer.company_name %}
                            <p class="mb-1 text-muted small">{{ invoice.customer.company_name }}</p>
                        {% endif %}

                        {% if invoice.customer.phone %}
                            <p class="mb-1">
                                <span class="text-muted small">ğŸ“</span>
                                <span class="small">{{ invoice.customer.phone }}</span>
                            </p>
                        {% endif %}

                        {% if invoice.customer.email %}
                            <p class="mb-0">
                                <span class="text-muted small">âœ‰</span>
                                <span class="small">{{ invoice.customer.email }}</span>
                            </p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
            <div class="col-md-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <h5 class="card-title mb-3">{% trans "ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©" %}</h5>
                        <p class="mb-1 small">
                            <span class="text-muted">{% trans "Ø§Ù„ØªØ§Ø±ÙŠØ®:" %}</span>
                            <span class="fw-semibold">{{ invoice.issued_at|date:"d M Y" }}</span>
                        </p>
                        <p class="mb-1 small">
                            <span class="text-muted">{% trans "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚:" %}</span>
                            <span class="fw-semibold">
              {% if invoice.due_date %}
                  {{ invoice.due_date|date:"d M Y" }}
              {% else %}
                  -
              {% endif %}
            </span>
                        </p>
                        <p class="mb-0 small">
    <span class="text-muted">{% trans "Ø§Ù„Ø­Ø§Ù„Ø©:" %}</span>
    <span class="{{ invoice.status_badge }} ms-1">
        {{ invoice.get_status_display }}
    </span>
</p>

                    </div>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ù…Ø¨Ø§Ù„Øº -->
        <div class="card border-0 shadow-sm mb-3">
            <div class="card-body">
                <h5 class="card-title mb-3">{% trans "Ø§Ù„Ù…Ø¨Ø§Ù„Øº" %}</h5>
                <div class="row">
                    <div class="col-md-4 col-sm-6 mb-2">
                        <div class="small text-muted mb-1">{% trans "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ" %}</div>
                        <div class="fw-semibold">{{ invoice.total_amount }}</div>
                    </div>
                    <div class="col-md-4 col-sm-6 mb-2">
                        <div class="small text-muted mb-1">{% trans "Ø§Ù„Ù…Ø¯ÙÙˆØ¹" %}</div>
                        <div class="fw-semibold">{{ invoice.paid_amount }}</div>
                    </div>
                    <div class="col-md-4 col-sm-6 mb-2">
                        <div class="small text-muted mb-1">{% trans "Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ" %}</div>
                        <div class="fw-semibold">{{ invoice.balance }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø¨Ù†ÙˆØ¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
        <div class="card border-0 shadow-sm mb-3">
            <div class="card-body">
                <h5 class="card-title mb-3">{% trans "Ø¨Ù†ÙˆØ¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø©" %}</h5>

                <div class="table-responsive">
                    <table class="table table-sm align-middle invoice-items-table mb-0">
                        <thead class="table-light">
                        <tr>
                            <th class="product-col">{% trans "Ø§Ù„Ù…Ù†ØªØ¬" %}</th>
                            <th class="desc-col">{% trans "Ø§Ù„ÙˆØµÙ" %}</th>
                            <th class="qty-col text-center">{% trans "Ø§Ù„ÙƒÙ…ÙŠØ©" %}</th>
                            <th class="price-col text-center">{% trans "Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©" %}</th>
                            <th class="total-col text-end">{% trans "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ" %}</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for item in invoice.items.all %}
                            <tr>
                                <td class="product-col">
                                    {% if item.product %}
                                        {{ item.product.name }}
                                    {% else %}
                                        <span class="text-muted small">â€”</span>
                                    {% endif %}
                                </td>
                                <td class="desc-col small">
                                    {% if item.description %}
                                        {{ item.description }}
                                    {% elif item.product %}
                                        {{ item.product.description }}
                                    {% else %}
                                        <span class="text-muted">â€”</span>
                                    {% endif %}
                                </td>
                                <td class="qty-col text-center">
                                    {{ item.quantity }}
                                </td>
                                <td class="price-col text-center">
                                    {{ item.unit_price }}
                                </td>
                                <td class="total-col text-end">
                                    <span class="invoice-line-total">{{ item.subtotal }}</span>
                                </td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="5" class="text-center text-muted small py-3">
                                    {% trans "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù†ÙˆØ¯ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©." %}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <!-- Ø§Ù„ÙˆØµÙ -->
        {% if invoice.description %}
            <div class="card border-0 shadow-sm mb-3">
                <div class="card-body">
                    <h5 class="card-title mb-3">{% trans "Ø§Ù„ÙˆØµÙ" %}</h5>
                    <p class="mb-0 small">{{ invoice.description|linebreaks }}</p>
                </div>
            </div>
        {% endif %}

        <!-- Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… -->
        {% if invoice.terms %}
            <div class="card border-0 shadow-sm mb-3">
                <div class="card-body">
                    <h5 class="card-title mb-3">{% trans "Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…" %}</h5>
                    <p class="mb-0 small">{{ invoice.terms|linebreaks }}</p>
                </div>
            </div>
        {% endif %}

        <!-- Ø§Ù„Ø¯ÙØ¹Ø§Øª -->
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <h5 class="card-title mb-3">{% trans "Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©" %}</h5>
                <div class="table-responsive">
                    <table class="table table-sm align-middle mb-0">
                        <thead>
                        <tr>
                            <th>{% trans "Ø§Ù„ØªØ§Ø±ÙŠØ®" %}</th>
                            <th>{% trans "Ø§Ù„Ù…Ø¨Ù„Øº" %}</th>
                            <th>{% trans "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹" %}</th>
                            <th>{% trans "Ø§Ù„ÙØ§ØªÙˆØ±Ø©" %}</th>
                            <th>{% trans "Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª" %}</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for payment in invoice.payments.all %}
                            <tr>
                                <td>{{ payment.date }}</td>
                                <td>{{ payment.amount }}</td>
                                <td>{{ payment.get_method_display }}</td>
                                <td>
                                    {% if payment.invoice %}
                                        {{ payment.invoice.number }}
                                    {% else %}
                                        <span class="text-muted">{% trans "Ø¯ÙØ¹Ø© Ø¹Ø§Ù…Ø©" %}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{% url 'accounting:payment_print' pk=payment.pk %}"
                                       class="btn btn-outline-primary btn-sm">
                                        ğŸ–¨ï¸ {% trans "Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„" %}
                                    </a>
                                </td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="5" class="text-muted text-center">
                                    {% trans "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙØ¹Ø§Øª Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ø¹Ø¯." %}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
{% endblock %}
