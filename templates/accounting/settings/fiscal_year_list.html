{% extends "accounting/base_accounting.html" %}
{% load i18n %}

{% block accounting_content %}
<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
  <div>
    <h2 class="h5 mb-1">{% trans "السنوات المالية" %}</h2>
    <p class="text-muted small mb-0">
      {% trans "من هنا يمكنك إدارة فترات عمل النظام (البداية والنهاية) وإقفال السنوات المالية بعد الانتهاء منها." %}
    </p>
  </div>
  <a href="{% url 'accounting:fiscal_year_create' %}" class="btn btn-sm btn-primary">
    <i class="bi bi-plus-lg"></i> {% trans "إنشاء سنة مالية جديدة" %}
  </a>
</div>

<div class="card shadow-sm border-0">
  <div class="card-body p-0">

    <div class="table-responsive">
      <table class="table table-hover table-sm mb-0 align-middle">
        <thead class="table-light small text-muted">
          <tr>
            <th style="width: 10%;">{% trans "السنة" %}</th>
            <th style="width: 35%;">{% trans "الفترة" %}</th>
            <th style="width: 20%;">{% trans "الحالة" %}</th>
            <th class="text-end" style="width: 35%;">{% trans "الإجراءات" %}</th>
          </tr>
        </thead>
        <tbody>
          {% for y in years %}
          <tr>
            <td class="fw-semibold">
              {{ y.year }}
              {% if y.is_default %}
                <span class="badge bg-primary-subtle text-primary border border-primary-subtle ms-1">
                  {% trans "افتراضية" %}
                </span>
              {% endif %}
            </td>
            <td>
              <div class="small text-muted">
                {{ y.start_date }} — {{ y.end_date }}
              </div>
            </td>
            <td>
              {% if y.is_closed %}
                <span class="badge rounded-pill bg-danger-subtle text-danger border border-danger-subtle px-3 py-1">
                  {% trans "مقفلة" %}
                </span>
              {% else %}
                <span class="badge rounded-pill bg-success-subtle text-success border border-success-subtle px-3 py-1">
                  {% trans "مفتوحة" %}
                </span>
              {% endif %}
            </td>
            <td class="text-end">
              <div class="btn-group btn-group-sm" role="group">
                <a href="{% url 'accounting:fiscal_year_edit' y.pk %}"
                   class="btn btn-outline-secondary">
                  {% trans "تعديل" %}
                </a>

                {% if not y.is_closed %}
                  <form method="post"
                        action="{% url 'accounting:fiscal_year_close' y.pk %}"
                        class="d-inline"
                        onsubmit="return confirm('{% trans "هل أنت متأكد من إقفال هذه السنة المالية؟" %}');">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-danger">
                      {% trans "إقفال" %}
                    </button>
                  </form>
                {% endif %}
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="4" class="text-center py-4 text-muted small">
              {% trans "لا توجد سنوات مالية مُسجّلة حتى الآن." %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
</div>
{% endblock %}
