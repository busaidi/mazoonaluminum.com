{% load static i18n %}
<!doctype html>
<html lang="{{ LANGUAGE_CODE }}" dir="{% if LANGUAGE_CODE == 'ar' %}rtl{% else %}ltr{% endif %}" data-bs-theme="light">
<head>
  <meta charset="utf-8"/>

  <title>
  {% block meta_title %}
    {% block title %}Mazoon Aluminum{% endblock %}
  {% endblock %}
  </title>

  <meta name="description"
        content="{% block meta_description %}High-quality aluminum systems, profiles, and solutions by Mazoon Aluminum.{% endblock %}">

  {% with cur_path=request.path host=request.get_host scheme=request.scheme %}
    {% if cur_path|slice:":4" == "/en/" %}
      {% with path_no_lang=cur_path|slice:"4:" %}
        {% with en_path=cur_path ar_path="/ar/"|add:path_no_lang %}
          <link rel="canonical" href="{{ scheme }}://{{ host }}{{ cur_path }}">
          <link rel="alternate" hreflang="en" href="{{ scheme }}://{{ host }}{{ en_path }}">
          <link rel="alternate" hreflang="ar" href="{{ scheme }}://{{ host }}{{ ar_path }}">
          <link rel="alternate" hreflang="x-default" href="{{ scheme }}://{{ host }}{{ cur_path }}">
        {% endwith %}
      {% endwith %}
    {% elif cur_path|slice:":4" == "/ar/" %}
      {% with path_no_lang=cur_path|slice:"4:" %}
        {% with ar_path=cur_path en_path="/en/"|add:path_no_lang %}
          <link rel="canonical" href="{{ scheme }}://{{ host }}{{ cur_path }}">
          <link rel="alternate" hreflang="ar" href="{{ scheme }}://{{ host }}{{ ar_path }}">
          <link rel="alternate" hreflang="en" href="{{ scheme }}://{{ host }}{{ en_path }}">
          <link rel="alternate" hreflang="x-default" href="{{ scheme }}://{{ host }}{{ cur_path }}">
        {% endwith %}
      {% endwith %}
    {% else %}
      {% with en_path="/en/" ar_path="/ar/" %}
        <link rel="canonical" href="{{ scheme }}://{{ host }}{{ cur_path }}">
        <link rel="alternate" hreflang="en" href="{{ scheme }}://{{ host }}{{ en_path }}">
        <link rel="alternate" hreflang="ar" href="{{ scheme }}://{{ host }}{{ ar_path }}">
        <link rel="alternate" hreflang="x-default" href="{{ scheme }}://{{ host }}{{ cur_path }}">
      {% endwith %}
    {% endif %}
  {% endwith %}

  <meta property="og:title"
        content="{% block og_title %}{% block og_title_inner %}Mazoon Aluminum{% endblock %}{% endblock %}">
  <meta property="og:description"
        content="{% block og_description %}{% endblock %}">
  <meta property="og:type"
        content="{% block og_type %}website{% endblock %}">
  <meta property="og:url"
        content="{% block og_url %}{{ request.build_absolute_uri }}{% endblock %}">
  <meta property="og:image"
        content="{% block og_image %}{% static 'img/mazoon/og-home.webp' %}{% endblock %}">

  <meta name="twitter:card"
        content="{% block twitter_card %}summary_large_image{% endblock %}">
  <meta name="twitter:title"
        content="{% block twitter_title %}{% endblock %}">
  <meta name="twitter:description"
        content="{% block twitter_description %}{% endblock %}">
  <meta name="twitter:image"
        content="{% block twitter_image %}{% static 'img/mazoon/og-home.webp' %}{% endblock %}">

  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  {% if LANGUAGE_CODE == "ar" %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.rtl.min.css"
          rel="stylesheet"
          crossorigin="anonymous"/>
  {% else %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
          rel="stylesheet"
          crossorigin="anonymous"/>
  {% endif %}

  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <link rel="stylesheet" href="{% static 'css/mazoon_style.css' %}"/>

  {% block extra_head %}{% endblock %}
</head>
<body class="bg-body-tertiary text-body d-flex flex-column min-vh-100">

{# ======== الشريط العلوي الصغير (Top Bar) ========= #}
{#<header class="bg-body-secondary border-bottom small">#}
{#  <div class="container-lg d-flex justify-content-between align-items-center py-1 gap-2">#}
{##}
    {# معلومات التواصل الأساسية #}
{#    <div class="d-flex flex-wrap align-items-center gap-3 text-muted">#}
{#      <span class="d-flex align-items-center gap-1">#}
{#        <i class="bi bi-telephone"></i>#}
{#        <span>+968 9XX XXX XX</span>#}
{#      </span>#}
{#      <span class="d-flex align-items-center gap-1 d-none d-lg-inline-flex">#}
{#        <i class="bi bi-envelope"></i>#}
{#        <span>info@mazoonaluminum.com</span>#}
{#      </span>#}
{#    </div>#}
{##}
    {# CTA سريع لأصحاب الورش + واتساب #}
{#    <div class="d-flex flex-wrap align-items-center gap-2">#}
{#      <span class="text-muted d-none d-lg-inline">#}
{#        {% trans "حلول خاصة للورش والمشاريع الكبيرة" %}#}
{#      </span>#}
{#      <a href="https://wa.me/9689XXXXXXX"#}
{#         class="btn btn-sm btn-outline-success d-flex align-items-center gap-1">#}
{#        <i class="bi bi-whatsapp"></i>#}
{#        <span>{% trans "تواصل عبر واتساب" %}</span>#}
{#      </a>#}
{#      <a href="{% url 'contact' %}"#}
{#         class="btn btn-sm btn-primary">#}
{#        {% trans "استشارة سريعة" %}#}
{#      </a>#}
{#    </div>#}
{##}
{#  </div>#}
{#</header>#}
<nav class="navbar navbar-expand-lg bg-body border-bottom shadow-sm sticky-top">
  <div class="container-lg">
    <a class="navbar-brand fw-bold d-flex align-items-center gap-2 py-2" href="{% url 'home' %}">
      <img src="{% static 'img/logo_mazoon_black.png' %}"
           alt="Mazoon Aluminum logo"
           class="img-fluid"
           style="height: 32px;">
    </a>

    <button class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#mainNavbar"
            aria-controls="mainNavbar"
            aria-expanded="false"
            aria-label="{% trans 'تبديل القائمة' %}">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="mainNavbar">
      {# روابط عامة #}
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.url_name == 'home' %}active{% endif %}"
             href="{% url 'home' %}">{% trans "الرئيسية" %}</a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.url_name == 'about' %}active{% endif %}"
             href="{% url 'about' %}">{% trans "من نحن" %}</a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.url_name == 'lab' %}active{% endif %}"
             href="{% url 'lab' %}">{% trans "المختبر" %}</a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.url_name == 'blog_list' or request.resolver_match.url_name == 'blog_detail' %}active{% endif %}"
             href="{% url 'blog_list' %}">{% trans "المدونة" %}</a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.url_name == 'product_list' %}active{% endif %}"
             href="{% url 'product_list' %}">{% trans "المنتجات" %}</a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.url_name == 'contact' %}active{% endif %}"
             href="{% url 'contact' %}">{% trans "اتصل بنا" %}</a>
        </li>
      </ul>

      {# يمين/يسار النافبار #}
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-center gap-2">

        {% if user.is_authenticated and user.customer_profile %}
          <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.namespace == 'portal' %}active{% endif %}"
               href="{% url 'portal:dashboard' %}">
              {% trans "بوابة الزبون" %}
            </a>
          </li>
        {% endif %}

        {% if user.is_authenticated %}
          {% if user.is_staff or user.is_superuser %}

            <li class="nav-item">
              <a class="nav-link {% if request.resolver_match.namespace == 'sales' %}active{% endif %}"
                 href="{% url 'sales:dashboard' %}">
                {% trans "المبيعات" %}
              </a>
            </li>

            <li class="nav-item">
              <a class="nav-link {% if request.resolver_match.namespace == 'inventory' %}active{% endif %}"
                 href="{% url 'inventory:dashboard' %}">
                {% trans "المخزون" %}
              </a>
            </li>

            <li class="nav-item">
              <a class="nav-link {% if request.resolver_match.namespace == 'accounting' %}active{% endif %}"
                 href="{% url 'accounting:dashboard' %}">
                {% trans "المحاسبة" %}
              </a>
            </li>

            <li class="nav-item">
              <a class="nav-link {% if request.resolver_match.namespace == 'core' and request.resolver_match.url_name == 'audit_log_list' %}active{% endif %}"
                 href="{% url 'core:audit_log_list' %}">
                {% trans "سجل التدقيق" %}
              </a>
            </li>
          {% endif %}
        {% endif %}

        {% include "core/notifications/_navbar_dropdown.html" %}

        {% if user.is_authenticated %}
          <li class="nav-item dropdown">
            <a class="nav-link d-flex align-items-center gap-2"
               href="#"
               id="userMenuDropdown"
               role="button"
               data-bs-toggle="dropdown"
               aria-expanded="false">
              <span class="rounded-circle d-inline-flex justify-content-center align-items-center bg-dark text-white"
                    style="width: 32px; height: 32px; font-size: 0.8rem;">
                {{ user.username|first|upper }}
              </span>
              <span class="d-none d-xl-inline small text-muted">
                {{ user.get_full_name|default:user.username }}
              </span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end shadow-sm small" aria-labelledby="userMenuDropdown">
              <li class="dropdown-header">
                <div class="fw-semibold">{{ user.get_full_name|default:user.username }}</div>
                <div class="text-muted small">{{ user.email|default:"" }}</div>
              </li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <a class="dropdown-item" href="{% comment %}{% url 'portal:profile' %}{% endcomment %}">
                  {% trans "الملف الشخصي" %}
                </a>
              </li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <form action="{% url 'logout' %}" method="post">
                  {% csrf_token %}
                  <button type="submit" class="dropdown-item text-danger">
                    {% trans "تسجيل الخروج" %}
                  </button>
                </form>
              </li>
            </ul>
          </li>
        {% else %}
          <li class="nav-item">
            <a class="btn btn-outline-primary btn-sm"
               href="{% url 'login' %}?next={{ request.path }}">
              {% trans "تسجيل الدخول" %}
            </a>
          </li>
        {% endif %}

        <li class="nav-item">
          <button class="btn btn-sm btn-outline-secondary d-flex align-items-center justify-content-center"
                  type="button"
                  id="themeToggleBtn"
                  aria-label="{% trans 'تبديل وضع اللون' %}"
                  title="{% trans 'تبديل وضع اللون' %}">
            <i class="bi bi-moon-stars" id="themeToggleIcon"></i>
          </button>
        </li>

        <li class="nav-item">
          <form action="{% url 'set_language' %}" method="post" class="d-flex align-items-center">
            {% csrf_token %}
            <input name="next" type="hidden" value="{{ request.get_full_path }}"/>
            <select name="language"
                    class="form-select form-select-sm"
                    onchange="this.form.submit()">
              <option value="ar" {% if LANGUAGE_CODE == 'ar' %}selected{% endif %}>العربية</option>
              <option value="en" {% if LANGUAGE_CODE == 'en' %}selected{% endif %}>English</option>
            </select>
          </form>
        </li>

      </ul>
    </div>
  </div>
</nav>

<main class="py-4 py-md-5 flex-grow-1">
  <div class="container-lg">

    {% if messages %}
      <div class="mb-3">
        {% for message in messages %}
          <div class="alert
                      {% if 'error' in message.tags %}alert-danger
                      {% elif 'success' in message.tags %}alert-success
                      {% elif 'warning' in message.tags %}alert-warning
                      {% elif 'info' in message.tags %}alert-info
                      {% else %}alert-info{% endif %}
                      mb-2"
               role="alert">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    {% block content %}{% endblock %}
  </div>
</main>

<footer class="border-top py-3 mt-auto bg-body-tertiary">
  <div class="container-lg d-flex flex-column flex-md-row justify-content-between align-items-center text-muted small gap-2">
    <div>
      &copy; {% now "Y" %} Mazoon Aluminum – {% trans "جميع الحقوق محفوظة" %}
    </div>
    <div class="d-flex gap-3">
      <a href="{% url 'home' %}" class="link-secondary text-decoration-none small">{% trans "الرئيسية" %}</a>
      <a href="#" class="link-secondary text-decoration-none small">{% trans "الخصوصية" %}</a>
      <a href="#" class="link-secondary text-decoration-none small">{% trans "الشروط والأحكام" %}</a>
    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>

<script>
  (function () {
    const THEME_KEY = "mazoonTheme";
    const root = document.documentElement;

    function getStoredTheme() {
      return localStorage.getItem(THEME_KEY);
    }

    function setStoredTheme(theme) {
      localStorage.setItem(THEME_KEY, theme);
    }

    function applyTheme(theme) {
      root.setAttribute("data-bs-theme", theme);
      const icon = document.getElementById("themeToggleIcon");
      if (!icon) return;
      if (theme === "dark") {
        icon.classList.remove("bi-moon-stars");
        icon.classList.add("bi-sun");
      } else {
        icon.classList.remove("bi-sun");
        icon.classList.add("bi-moon-stars");
      }
    }

    const stored = getStoredTheme();
    const preferred = stored || "light";
    applyTheme(preferred);

    window.addEventListener("DOMContentLoaded", function () {
      const btn = document.getElementById("themeToggleBtn");
      if (!btn) return;

      btn.addEventListener("click", function () {
        const current = root.getAttribute("data-bs-theme") === "dark" ? "dark" : "light";
        const next = current === "dark" ? "light" : "dark";
        applyTheme(next);
        setStoredTheme(next);
      });
    });
  })();
</script>

{% block extra_body %}{% endblock %}
</body>
</html>
