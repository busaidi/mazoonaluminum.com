{% extends "inventory/base_inventory.html" %}
{% load i18n %}

{% block title %}
  {% if object %}
    {% trans "تعديل مستوى مخزون" %}
  {% else %}
    {% trans "إضافة مستوى مخزون" %}
  {% endif %}
{% endblock %}

{% block inventory_content %}

{# هيدر Mazoon لفورم مستوى المخزون #}
<div class="card border-0 shadow-sm mb-3 bg-mazoon-card">
  <div class="card-body d-flex justify-content-between align-items-center gap-3">
    <div>
      <h1 class="h5 fw-bold mb-1 text-mazoon">
        {% if object %}
          {% trans "تعديل مستوى المخزون" %}
        {% else %}
          {% trans "إضافة مستوى مخزون لمنتج" %}
        {% endif %}
      </h1>
      <p class="text-muted small mb-0">
        {% trans "تحديد الكميات المتوفرة والمحجوزة والحد الأدنى لكل منتج في مخزن وموقع معيّن." %}
      </p>
    </div>
    <div class="d-flex flex-wrap gap-2">
      <a href="{% url 'inventory:stocklevel_list' %}"
         class="btn btn-sm btn-outline-secondary">
        <i class="bi bi-arrow-right-short ms-1"></i>
        {% trans "رجوع إلى مستويات المخزون" %}
      </a>
    </div>
  </div>
</div>

<div class="card border-0 shadow-sm">
  <div class="card-body">

    <form method="post" class="row g-3">
      {% csrf_token %}

      {# أخطاء عامة #}
      {% if form.non_field_errors %}
        <div class="col-12">
          <div class="alert alert-danger small mb-2">
            {% for error in form.non_field_errors %}
              <div>{{ error }}</div>
            {% endfor %}
          </div>
        </div>
      {% endif %}

      <div class="col-md-6">
        <label for="{{ form.product.id_for_label }}" class="form-label small fw-semibold">
          {{ form.product.label }}
        </label>
        {{ form.product }}
        {% if form.product.help_text %}
          <div class="form-text small">{{ form.product.help_text }}</div>
        {% endif %}
        {% for error in form.product.errors %}
          <div class="text-danger small">{{ error }}</div>
        {% endfor %}
      </div>

      <div class="col-md-3">
        <label for="{{ form.warehouse.id_for_label }}" class="form-label small fw-semibold">
          {{ form.warehouse.label }}
        </label>
        {{ form.warehouse }}
        {% if form.warehouse.help_text %}
          <div class="form-text small">{{ form.warehouse.help_text }}</div>
        {% endif %}
        {% for error in form.warehouse.errors %}
          <div class="text-danger small">{{ error }}</div>
        {% endfor %}
      </div>

      <div class="col-md-3">
        <label for="{{ form.location.id_for_label }}" class="form-label small fw-semibold">
          {{ form.location.label }}
        </label>
        {{ form.location }}
        {% if form.location.help_text %}
          <div class="form-text small">{{ form.location.help_text }}</div>
        {% endif %}
        {% for error in form.location.errors %}
          <div class="text-danger small">{{ error }}</div>
        {% endfor %}
      </div>

      <hr class="mt-3 mb-1">

      <div class="col-md-3">
        <label for="{{ form.quantity_on_hand.id_for_label }}" class="form-label small fw-semibold">
          {{ form.quantity_on_hand.label }}
        </label>
        {{ form.quantity_on_hand }}
        {% if form.quantity_on_hand.help_text %}
          <div class="form-text small">{{ form.quantity_on_hand.help_text }}</div>
        {% endif %}
        {% for error in form.quantity_on_hand.errors %}
          <div class="text-danger small">{{ error }}</div>
        {% endfor %}
      </div>

      <div class="col-md-3">
        <label for="{{ form.quantity_reserved.id_for_label }}" class="form-label small fw-semibold">
          {{ form.quantity_reserved.label }}
        </label>
        {{ form.quantity_reserved }}
        {% if form.quantity_reserved.help_text %}
          <div class="form-text small">{{ form.quantity_reserved.help_text }}</div>
        {% endif %}
        {% for error in form.quantity_reserved.errors %}
          <div class="text-danger small">{{ error }}</div>
        {% endfor %}
      </div>

      <div class="col-md-3">
        <label for="{{ form.min_stock.id_for_label }}" class="form-label small fw-semibold">
          {{ form.min_stock.label }}
        </label>
        {{ form.min_stock }}
        {% if form.min_stock.help_text %}
          <div class="form-text small">{{ form.min_stock.help_text }}</div>
        {% endif %}
        {% for error in form.min_stock.errors %}
          <div class="text-danger small">{{ error }}</div>
        {% endfor %}
      </div>

      {# أي حقول مخفية #}
      {% for field in form.hidden_fields %}
        {{ field }}
      {% endfor %}

      <div class="col-12 mt-3 d-flex justify-content-between align-items-center">
        <div class="text-muted small">
          {% trans "استخدام الحد الأدنى يساعد في تفعيل تنبيهات انخفاض المخزون في التقارير ولوحة التحكم." %}
        </div>
        <div class="d-flex gap-2">
          <a href="{% url 'inventory:stocklevel_list' %}"
             class="btn btn-outline-secondary">
            {% trans "إلغاء" %}
          </a>
          <button type="submit" class="btn btn-primary">
            {% if object %}
              <i class="bi bi-save ms-1"></i>
              {% trans "حفظ التعديلات" %}
            {% else %}
              <i class="bi bi-check2-circle ms-1"></i>
              {% trans "حفظ المستوى" %}
            {% endif %}
          </button>
        </div>
      </div>

    </form>

  </div>
</div>

{% endblock %}
