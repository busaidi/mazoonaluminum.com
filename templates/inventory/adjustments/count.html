{% extends "inventory/base_inventory.html" %}
{% load i18n %}

{% block inventory_title %}{% trans "إدخال العد" %} #{{ object.pk }}{% endblock %}

{% block inventory_content %}
<div class="py-3">

    <form method="post">
        {% csrf_token %}

        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="h4 mb-1 text-gray-800">
                    <span class="text-muted">#{{ object.pk }}</span>
                    {% trans "إدخال الكميات الفعلية" %}
                </h1>
                <p class="text-muted small mb-0">
                    <i class="bi bi-building me-1"></i> {{ object.warehouse.name }}
                    <span class="mx-2">|</span>
                    {{ object.date }}
                </p>
            </div>
            <div>
                <button type="submit" class="btn btn-success px-4">
                    <i class="bi bi-check2-all me-1"></i> {% trans "حفظ ومراجعة" %}
                </button>
            </div>
        </div>

        <div class="card shadow-sm border-0">
            <div class="table-responsive">
                {{ lines_formset.management_form }}

                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th class="ps-4">{% trans "المنتج" %}</th>
                            <th>{% trans "الموقع" %}</th>
                            <th class="text-center" style="width: 15%">{% trans "النظام (نظري)" %}</th>
                            <th style="width: 20%">{% trans "العد الفعلي" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for form in lines_formset %}
                            {% with line=form.instance %}
                            <tr>
                                {{ form.id }} <td class="ps-4">
                                    <div class="fw-bold">{{ line.product.name }}</div>
                                    <div class="small text-muted font-monospace">{{ line.product.code }}</div>
                                </td>
                                <td>
                                    <span class="badge bg-light text-dark border">{{ line.location.name }}</span>
                                </td>
                                <td class="text-center text-muted">
                                    {{ line.theoretical_qty|floatformat:2 }}
                                    <small>{{ line.product.base_uom.name }}</small>
                                </td>
                                <td>
                                    {{ form.counted_qty }}
                                    {% if form.counted_qty.errors %}
                                        <div class="text-danger small mt-1">{{ form.counted_qty.errors|join:", " }}</div>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endwith %}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </form>
</div>
{% endblock %}