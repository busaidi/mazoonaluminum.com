{% extends "inventory/base_inventory.html" %}
{% load i18n %}

{% block title %}{% trans "بيانات المنتج" %}{% endblock %}

{% block inventory_content %}


<div class="card border-0 shadow-sm mb-3 bg-mazoon-card">
  <div class="card-body d-flex justify-content-between align-items-center gap-3">
    <div>
      <h1 class="h5 fw-bold mb-1 text-mazoon">
        {% if mode == "create" %}
          {% trans "إضافة منتج جديد" %}
        {% else %}
          {% trans "تعديل بيانات المنتج" %}
        {% endif %}
      </h1>
      <p class="text-muted small mb-0">
        {% if mode == "create" %}
          {% trans "قم بتعريف منتج جديد مع وحدات القياس وحالة التتبع في المخزون والنشر." %}
        {% else %}
          {% trans "تحديث بيانات المنتج والوصف ووحدات القياس وحالة المخزون." %}
        {% endif %}
      </p>
    </div>

    <div class="d-flex flex-wrap gap-2">
      <a href="{% url 'inventory:product_list' %}"
         class="btn btn-sm btn-outline-secondary">
        <i class="bi bi-arrow-right-short ms-1"></i>
        {% trans "رجوع لقائمة المنتجات" %}
      </a>
    </div>
  </div>
</div>


<div class="card border-0 shadow-sm">
  <div class="card-body">

    <form method="post" enctype="multipart/form-data" class="row g-3">
      {% csrf_token %}

      {# أخطاء عامة على مستوى الفورم #}
      {% if form.non_field_errors %}
        <div class="col-12">
          <div class="alert alert-danger small mb-0">
            {% for error in form.non_field_errors %}
              <div>{{ error }}</div>
            {% endfor %}
          </div>
        </div>
      {% endif %}


      <div class="col-md-7">

        <section class="mb-3">
          <h2 class="h6 fw-bold mb-2">
            <i class="bi bi-box-seam me-1"></i>
            {% trans "البيانات الأساسية" %}
          </h2>

          <div class="mb-3">
            <label for="{{ form.category.id_for_label }}" class="form-label small fw-semibold">
              {{ form.category.label }}
            </label>
            {{ form.category }}
            {% if form.category.help_text %}
              <div class="form-text small">{{ form.category.help_text }}</div>
            {% endif %}
            {% for error in form.category.errors %}
              <div class="text-danger small">{{ error }}</div>
            {% endfor %}
          </div>
          <div class="mb-3">
    <label for="{{ form.product_type.id_for_label }}" class="form-label small fw-semibold">
      {{ form.product_type.label }}
    </label>
    {{ form.product_type }}
    {% if form.product_type.help_text %}
      <div class="form-text small">{{ form.product_type.help_text }}</div>
    {% endif %}
    {% for error in form.product_type.errors %}
      <div class="text-danger small">{{ error }}</div>
    {% endfor %}
  </div>


          <div class="row g-3">
            <div class="col-sm-6">
              <label for="{{ form.code.id_for_label }}" class="form-label small fw-semibold">
                {{ form.code.label }}
              </label>
              {{ form.code }}
              {% if form.code.help_text %}
                <div class="form-text small">{{ form.code.help_text }}</div>
              {% endif %}
              {% for error in form.code.errors %}
                <div class="text-danger small">{{ error }}</div>
              {% endfor %}
            </div>

            <div class="col-sm-6">
              <label for="{{ form.name.id_for_label }}" class="form-label small fw-semibold">
                {{ form.name.label }}
              </label>
              {{ form.name }}
              {% if form.name.help_text %}
                <div class="form-text small">{{ form.name.help_text }}</div>
              {% endif %}
              {% for error in form.name.errors %}
                <div class="text-danger small">{{ error }}</div>
              {% endfor %}
            </div>
          </div>
        </section>

        {# قسم الأسعار الافتراضية #}
        <section class="mb-3">
          <h2 class="h6 fw-bold mb-2">
            <i class="bi bi-cash-coin me-1"></i>
            {% trans "الأسعار الافتراضية" %}
          </h2>

          <div class="row g-3">
            <div class="col-sm-6">
              <label for="{{ form.default_sale_price.id_for_label }}" class="form-label small fw-semibold">
                {{ form.default_sale_price.label }}
              </label>
              {{ form.default_sale_price }}
              {% if form.default_sale_price.help_text %}
                <div class="form-text small">{{ form.default_sale_price.help_text }}</div>
              {% endif %}
              {% for error in form.default_sale_price.errors %}
                <div class="text-danger small">{{ error }}</div>
              {% endfor %}
            </div>

            <div class="col-sm-6">
              <label for="{{ form.default_cost_price.id_for_label }}" class="form-label small fw-semibold">
                {{ form.default_cost_price.label }}
              </label>
              {{ form.default_cost_price }}
              {% if form.default_cost_price.help_text %}
                <div class="form-text small">{{ form.default_cost_price.help_text }}</div>
              {% endif %}
              {% for error in form.default_cost_price.errors %}
                <div class="text-danger small">{{ error }}</div>
              {% endfor %}
            </div>
          </div>
        </section>

        <section class="mb-3">
          <h2 class="h6 fw-bold mb-2">
            <i class="bi bi-card-text me-1"></i>
            {% trans "الوصف" %}
          </h2>

          <div class="mb-3">
            <label for="{{ form.short_description.id_for_label }}" class="form-label small fw-semibold">
              {{ form.short_description.label }}
            </label>
            {{ form.short_description }}
            {% if form.short_description.help_text %}
              <div class="form-text small">{{ form.short_description.help_text }}</div>
            {% endif %}
            {% for error in form.short_description.errors %}
              <div class="text-danger small">{{ error }}</div>
            {% endfor %}
          </div>

          <div class="mb-0">
            <label for="{{ form.description.id_for_label }}" class="form-label small fw-semibold">
              {{ form.description.label }}
            </label>
            {{ form.description }}
            {% if form.description.help_text %}
              <div class="form-text small">{{ form.description.help_text }}</div>
            {% endif %}
            {% for error in form.description.errors %}
              <div class="text-danger small">{{ error }}</div>
            {% endfor %}
          </div>
        </section>

      </div>

      <div class="col-md-5">

        {# وحدات القياس #}
        <section class="border rounded-3 p-3 mb-3 bg-light-subtle">
          <h2 class="h6 fw-bold small mb-2 d-flex align-items-center gap-2">
            <span class="feature-icon">
              <i class="bi bi-rulers"></i>
            </span>
            <span>{% trans "وحدات القياس" %}</span>
          </h2>

          <div class="mb-3">
            <label for="{{ form.base_uom.id_for_label }}" class="form-label small fw-semibold">
              {{ form.base_uom.label }}
            </label>
            {{ form.base_uom }}
            {% if form.base_uom.help_text %}
              <div class="form-text small">{{ form.base_uom.help_text }}</div>
            {% endif %}
            {% for error in form.base_uom.errors %}
              <div class="text-danger small">{{ error }}</div>
            {% endfor %}
          </div>

          <div class="row g-3">
            <div class="col-sm-6">
              <label for="{{ form.alt_uom.id_for_label }}" class="form-label small fw-semibold">
                {{ form.alt_uom.label }}
              </label>
              {{ form.alt_uom }}
              {% if form.alt_uom.help_text %}
                <div class="form-text small">{{ form.alt_uom.help_text }}</div>
              {% endif %}
              {% for error in form.alt_uom.errors %}
                <div class="text-danger small">{{ error }}</div>
              {% endfor %}
            </div>

            <div class="col-sm-6">
              <label for="{{ form.alt_factor.id_for_label }}" class="form-label small fw-semibold">
                {{ form.alt_factor.label }}
              </label>
              {{ form.alt_factor }}
              {% if form.alt_factor.help_text %}
                <div class="form-text small">{{ form.alt_factor.help_text }}</div>
              {% endif %}
              {% for error in form.alt_factor.errors %}
                <div class="text-danger small">{{ error }}</div>
              {% endfor %}
            </div>
          </div>

          <hr class="my-3">

          <div class="row g-3">
            <div class="col-sm-6">
              <label for="{{ form.weight_uom.id_for_label }}" class="form-label small fw-semibold">
                {{ form.weight_uom.label }}
              </label>
              {{ form.weight_uom }}
              {% if form.weight_uom.help_text %}
                <div class="form-text small">{{ form.weight_uom.help_text }}</div>
              {% endif %}
              {% for error in form.weight_uom.errors %}
                <div class="text-danger small">{{ error }}</div>
              {% endfor %}
            </div>

            <div class="col-sm-6">
              <label for="{{ form.weight_per_base.id_for_label }}" class="form-label small fw-semibold">
                {{ form.weight_per_base.label }}
              </label>
              {{ form.weight_per_base }}
              {% if form.weight_per_base.help_text %}
                <div class="form-text small">{{ form.weight_per_base.help_text }}</div>
              {% endif %}
              {% for error in form.weight_per_base.errors %}
                <div class="text-danger small">{{ error }}</div>
              {% endfor %}
            </div>
          </div>
        </section>

        {# حالة المنتج #}
        <section class="border rounded-3 p-3 bg-white">
          <h2 class="h6 fw-bold small mb-2 d-flex align-items-center gap-2">
            <span class="feature-icon">
              <i class="bi bi-toggle-on"></i>
            </span>
            <span>{% trans "حالة المنتج" %}</span>
          </h2>

          <div class="form-check form-switch mb-2">
            {{ form.is_stock_item }}
            <label for="{{ form.is_stock_item.id_for_label }}"
                   class="form-check-label small fw-semibold">
              {{ form.is_stock_item.label }}
            </label>
            {% if form.is_stock_item.help_text %}
              <div class="form-text small">{{ form.is_stock_item.help_text }}</div>
            {% endif %}
            {% for error in form.is_stock_item.errors %}
              <div class="text-danger small">{{ error }}</div>
            {% endfor %}
          </div>

          <div class="form-check form-switch mb-2">
            {{ form.is_active }}
            <label for="{{ form.is_active.id_for_label }}"
                   class="form-check-label small fw-semibold">
              {{ form.is_active.label }}
            </label>
            {% if form.is_active.help_text %}
              <div class="form-text small">{{ form.is_active.help_text }}</div>
            {% endif %}
            {% for error in form.is_active.errors %}
              <div class="text-danger small">{{ error }}</div>
            {% endfor %}
          </div>

          <div class="form-check form-switch mb-0">
            {{ form.is_published }}
            <label for="{{ form.is_published.id_for_label }}"
                   class="form-check-label small fw-semibold">
              {{ form.is_published.label }}
            </label>
            {% if form.is_published.help_text %}
              <div class="form-text small">{{ form.is_published.help_text }}</div>
            {% endif %}
            {% for error in form.is_published.errors %}
              <div class="text-danger small">{{ error }}</div>
            {% endfor %}
          </div>
        </section>

      </div>

      {# أزرار الحفظ بالأسفل #}
      <div class="col-12 mt-2 d-flex justify-content-between align-items-center">
        <div class="text-muted small">
          {% trans "الحقول الأساسية مثل الكود، الاسم، والوحدة الأساسية مطلوبة لربط المنتج بالمخزون والحركات." %}
        </div>

        <div class="d-flex gap-2">
          <a href="{% url 'inventory:product_list' %}"
             class="btn btn-outline-secondary">
            {% trans "إلغاء" %}
          </a>
          <button class="btn btn-primary">
            {% if mode == "create" %}
              <i class="bi bi-check2-circle ms-1"></i>
              {% trans "حفظ المنتج" %}
            {% else %}
              <i class="bi bi-check2-circle ms-1"></i>
              {% trans "حفظ التعديلات" %}
            {% endif %}
          </button>
        </div>
      </div>

    </form>

  </div>
</div>

{% endblock %}
