{% extends "base.html" %}

{% block title %}طلب #{{ order.id }}{% endblock %}

{% block content %}
<div class="container py-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4 mb-0">تفاصيل الطلب #{{ order.id }}</h1>
    <a href="{% url 'portal:order_list' %}" class="btn btn-secondary btn-sm">
      رجوع لطلباتي
    </a>
  </div>

  <div class="row g-3 mb-3">
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title">معلومات الطلب</h5>
          <p class="mb-1"><strong>رقم الطلب:</strong> {{ order.id }}</p>
          <p class="mb-1"><strong>التاريخ:</strong> {{ order.created_at|date:"Y-m-d H:i" }}</p>
          <p class="mb-1"><strong>الحالة:</strong> {{ order.get_status_display }}</p>
          <p class="mb-0"><strong>إجمالي الطلب:</strong> {{ order.total_amount }}</p>
        </div>
      </div>
    </div>

    {% if order.invoice %}
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title">الفاتورة المرتبطة</h5>
          <p class="mb-1"><strong>رقم الفاتورة:</strong> {{ order.invoice.number }}</p>
          <p class="mb-1"><strong>تاريخ الإصدار:</strong> {{ order.invoice.issued_at }}</p>
          <p class="mb-0"><strong>المبلغ:</strong> {{ order.invoice.total_amount }}</p>
        </div>
      </div>
    </div>
    {% endif %}
  </div>

  {% if order.notes %}
  <div class="card mb-3">
    <div class="card-body">
      <h5 class="card-title">ملاحظات</h5>
      <p class="mb-0">{{ order.notes|linebreaksbr }}</p>
    </div>
  </div>
  {% endif %}

  <div class="card">
    <div class="card-body">
      <h5 class="card-title">بنود الطلب</h5>
      <table class="table table-sm align-middle mb-0">
        <thead>
          <tr>
            <th>المنتج</th>
            <th>الوصف</th>
            <th class="text-center">الكمية</th>
            <th class="text-center">الوحدة</th>
            <th class="text-end">سعر الوحدة</th>
            <th class="text-end">الإجمالي</th>
          </tr>
        </thead>
        <tbody>
          {% for line in order.lines.all %}
          <tr>
            <td>{{ line.product.name_ar }}</td>
            <td>{{ line.description }}</td>
            <td class="text-center">{{ line.quantity }}</td>
            <td class="text-center">{{ line.unit_label }}</td>
            <td class="text-end">{{ line.unit_price }}</td>
            <td class="text-end">{{ line.total }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted">
              لا توجد بنود في هذا الطلب.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</div>
{% endblock %}
