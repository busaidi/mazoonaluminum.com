{# templates/sales/delivery/list.html #}
{% extends "sales/base_sales.html" %}
{% load i18n %}

{% block title %}{% trans "مذكرات التسليم" %}{% endblock %}

{% block sales_content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h1 class="h5 fw-bold mb-1">
      {% trans "مذكرات التسليم" %}
    </h1>
    <p class="text-muted small mb-0">
      {% trans "عرض ومتابعة مذكرات التسليم المرتبطة بأوامر البيع." %}
    </p>
  </div>
</div>

<div class="card shadow-sm border-0">
  <div class="card-body">
    {% if deliveries %}
      <div class="table-responsive">
        <table class="table table-sm align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th class="small text-muted">{% trans "الرقم" %}</th>
              <th class="small text-muted">{% trans "تاريخ التسليم" %}</th>
              <th class="small text-muted">{% trans "أمر البيع" %}</th>
              <th class="small text-muted">{% trans "العميل" %}</th>
              <th class="small text-muted">{% trans "الحالة" %}</th>
            </tr>
          </thead>
          <tbody>
            {% for d in deliveries %}
              <tr>
                <td class="small text-nowrap">
                  {# اسم الـ URL الصحيح في urls.py: delivery_note_detail #}
                  <a href="{% url 'sales:delivery_note_detail' d.pk %}"
                     class="text-mazoon text-decoration-none"
                     dir="ltr">
                    {{ d.display_number }}
                  </a>
                </td>
                <td class="small text-nowrap">
                  {{ d.date|date:"Y-m-d" }}
                </td>
                <td class="small text-nowrap">
                  {% if d.order %}
                    {# ما عندك order_detail، التفاصيل الموحدة هي sales_detail #}
                    <a href="{% url 'sales:sales_detail' d.order.pk %}"
                       class="text-decoration-none">
                      {{ d.order.display_number }}
                    </a>
                  {% else %}
                    <span class="text-muted">—</span>
                  {% endif %}
                </td>
                <td class="small">
                  {% if d.order and d.order.contact %}
                    {{ d.order.contact.name }}
                  {% else %}
                    <span class="text-muted">—</span>
                  {% endif %}
                </td>
                <td class="small">
                  {{ d.get_status_display }}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-muted small mb-0">
        {% trans "لا توجد مذكرات تسليم حتى الآن." %}
      </p>
    {% endif %}
  </div>
</div>

{% endblock %}
