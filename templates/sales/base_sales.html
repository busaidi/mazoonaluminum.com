{% extends "base.html" %}
{% load i18n static %}

{% block title %}{% trans "نظام المبيعات" %}{% endblock %}

{% block content %}

<div class="py-3 py-md-4">

  {# ======================= PAGE HEADER ======================= #}
  <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
    <div>
      <h1 class="h3 fw-bold mb-1 text-body">
        <i class="bi bi-shop me-2 text-primary"></i>
        {% trans "نظام المبيعات" %}
      </h1>
      <p class="text-muted mb-0 small">
        {% trans "إدارة دورة المبيعات، من عروض الأسعار وحتى التسليم." %}
      </p>
    </div>
  </div>

  {# ======================= NAVIGATION BAR (Horizontal) ======================= #}
  <div class="mb-4">
    <div class="bg-body border rounded-3 shadow-sm px-2 py-2">
      <ul class="nav nav-pills flex-wrap small gap-1 align-items-center">

        {# 1. لوحة التحكم #}
        <li class="nav-item">
          <a class="nav-link px-3 py-1 {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}"
             href="{% url 'sales:dashboard' %}">
            <i class="bi bi-speedometer2 me-1"></i>
            {% trans "الرئيسية" %}
          </a>
        </li>

        {# 2. الكل (مستندات المبيعات) #}
        <li class="nav-item">
          <a class="nav-link px-3 py-1
                     {% if request.resolver_match.url_name == 'document_list' and not request.GET.status %}active{% endif %}"
             href="{% url 'sales:document_list' %}">
            <i class="bi bi-files me-1"></i>
            {% trans "الكل" %}
          </a>
        </li>

        {# 3. عروض الأسعار (فلتر: مسودة / مرسل) #}
        <li class="nav-item">
          <a class="nav-link px-3 py-1 {% if 'status=draft' in request.get_full_path %}active{% endif %}"
             href="{% url 'sales:document_list' %}?status=draft">
            <i class="bi bi-file-earmark-text me-1"></i>
            {% trans "عروض الأسعار" %}
          </a>
        </li>

        {# 4. أوامر البيع (فلتر: مؤكد) #}
        <li class="nav-item">
          <a class="nav-link px-3 py-1 {% if 'status=confirmed' in request.get_full_path %}active{% endif %}"
             href="{% url 'sales:document_list' %}?status=confirmed">
            <i class="bi bi-cart-check me-1"></i>
            {% trans "أوامر البيع" %}
          </a>
        </li>

        {# 5. مذكرات التسليم #}
        <li class="nav-item">
          <a class="nav-link px-3 py-1 {% if 'deliveries' in request.path %}active{% endif %}"
             href="{% url 'sales:delivery_list' %}">
            <i class="bi bi-truck me-1"></i>
            {% trans "مذكرات التسليم" %}
          </a>
        </li>

        <li class="border-start mx-2 d-none d-lg-block"></li>

        {# 6. روابط مستقبلية (الفواتير) #}
        <li class="nav-item">
          <a class="nav-link px-3 py-1 disabled text-muted" href="#" tabindex="-1" aria-disabled="true">
            {% trans "الفواتير" %}
          </a>
        </li>

        {# 7. إجراءات سريعة (Dropdown) #}
        <li class="nav-item dropdown ms-lg-auto">
          <a class="btn btn-primary btn-sm px-3 py-1 dropdown-toggle shadow-sm"
             data-bs-toggle="dropdown"
             href="#"
             role="button"
             aria-expanded="false">
            <i class="bi bi-plus-lg"></i>
            <span class="d-none d-md-inline">
              {% trans "إجراء سريع" %}
            </span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end shadow-sm border-0">
            <li>
              <h6 class="dropdown-header text-uppercase small">
                {% trans "عمليات جديدة" %}
              </h6>
            </li>

            {# مستند مبيعات جديد #}
            <li>
              <a class="dropdown-item d-flex align-items-center"
                 href="{% url 'sales:document_create' %}">
                <i class="bi bi-file-earmark-plus text-primary me-2"></i>
                {% trans "مستند مبيعات جديد" %}
              </a>
            </li>

            {# تسليم مباشر جديد #}
            <li>
              <a class="dropdown-item d-flex align-items-center"
                 href="{% url 'sales:delivery_create_direct' %}">
                <i class="bi bi-lightning-charge text-warning me-2"></i>
                {% trans "تسليم مباشر (عاجل)" %}
              </a>
            </li>

            <li><hr class="dropdown-divider"></li>

            <li>
              <a class="dropdown-item d-flex align-items-center text-muted"
                 href="{% url 'sales:document_list' %}?status=confirmed"
                 title="{% trans 'يتم إنشاء التسليم من داخل أمر البيع المؤكد' %}">
                <i class="bi bi-truck text-secondary me-2"></i>
                {% trans "تسليم (من أمر بيع)" %}
              </a>
            </li>
          </ul>
        </li>

      </ul>
    </div>
  </div>

  {# ======================= CONTENT BLOCK ======================= #}
  <div class="fade-in">
    {% block sales_content %}{% endblock %}
  </div>

</div>

{% endblock content %}
