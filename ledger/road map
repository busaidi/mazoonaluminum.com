⭐ ثالثاً: خطة التنفيذ التي أنصحك بها
✔️ المرحلة 1: إضافة الترحيل Posting

(هذا أهم شيء الآن)

وظائف نضيفها:

posted = False/True

زر "ترحيل"

زر "إلغاء الترحيل"

Validation: لا يمكن تعديل قيد مُرحّل

Ledger يعتمد فقط على القيود المُرحّلة
-------------------------

✔️ المرحلة 2: إضافة دفاتر اليومية Journal Types

بعد الترحيل يكون:

دفتر الكاش

دفتر البنك

دفتر المبيعات

دفتر المشتريات

دفتر الرواتب

دفتر التسويات

دفتر عام
----------------------------------------
) Automatic Posting from System

ربط Ledger مع نظام المحاسبة:

أمثلة:

عندما تصدر فاتورة → ينشأ قيد:

Debit: Accounts Receivable

Credit: Sales

عندما تستلم دفعة → ينشأ قيد:

Debit: Cash/Bank

Credit: Accounts Receivable

لما تدفع مورد → ينشأ قيد تلقائي

لما تعمل Bill / Purchase Order → قيد مشتريات

لما تعمل Expense → قيد مصروفات

تحتاج:

Account Mapping

Auto Posting Service

زر "View Journal Entry" داخل الفاتورة

هذا أهم جزء يخلي النظام “ERP حقيقي”.
----------------------------------------------
✔️ المرحلة 3: دعم الإغلاق Closing

سنة مالية لها حالة: مفتوحة / مغلقة

لا يمكن تعديل القيود داخل سنة مغلقة

يتم إنشاء رصيد افتتاحي للسنة التالية تلقائيًا
--------------------------------------------------
✔️ المرحلة 4: كتابة Tests قوية

الترحيل

الإلغاء

الإغلاق

الرصيد الافتتاحي

تعدد السنوات

دفاتر اليومية

------------
) Audit Log للقيود (من عدّل؟ ما الذي تغيّر؟ متى؟)
هدفي؟

تعقب كامل لكل حركة:

من غيّر الحساب؟

من عدّل المدين/الدائن؟

من حذف سطر؟

من عدّل المرجع؟

كيف؟

Signal: pre_save / post_save على JournalEntry و JournalLine

حفظ نسخة JSON من قبل وبعد التعديل

هذه ميزة لو سويتها… نظامك يصير “Enterprise Grade”.